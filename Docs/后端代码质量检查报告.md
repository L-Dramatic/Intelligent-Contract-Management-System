# åç«¯ä»£ç è´¨é‡æ£€æŸ¥æŠ¥å‘Š

**é¡¹ç›®åç§°**ï¼šç”µä¿¡é¢†åŸŸæ™ºæ…§åˆåŒç®¡ç†ç³»ç»Ÿ  
**æ£€æŸ¥æ—¶é—´**ï¼š2025å¹´12æœˆ17æ—¥  
**æ£€æŸ¥èŒƒå›´**ï¼šå·²å®Œæˆçš„åç«¯ä»£ç é€»è¾‘ä¸è®¾è®¡é—®é¢˜  
**ä»£ç ç‰ˆæœ¬**ï¼šå½“å‰å¼€å‘ç‰ˆæœ¬

---

## ğŸ“‹ æ£€æŸ¥è¯´æ˜

æœ¬æŠ¥å‘Šèšç„¦äº**å·²å®ç°ä»£ç çš„è´¨é‡é—®é¢˜**ï¼Œä¸æ¶‰åŠæœªå¼€å‘åŠŸèƒ½çš„ç¼ºå¤±ã€‚ä¸»è¦æ£€æŸ¥ï¼š
- é€»è¾‘é”™è¯¯å’Œæ½œåœ¨Bug
- è®¾è®¡ç¼ºé™·
- ä»£ç è§„èŒƒé—®é¢˜
- æ€§èƒ½å’Œå®‰å…¨éšæ‚£

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ï¼ˆCriticalï¼‰

### 1. åˆåŒçŠ¶æ€ä¸å·¥ä½œæµä¸ä¸€è‡´

**ä½ç½®**ï¼š`ContractServiceImpl.createContract()` Line 52

```java
// æ³¨æ„ï¼šç›®å‰æˆ‘ä»¬è¿˜æ²¡æ¥å·¥ä½œæµï¼Œå…ˆéƒ½é»˜è®¤å­˜ä¸ºè‰ç¨¿(0)æˆ–å®¡æ‰¹ä¸­(1)
contract.setStatus(Boolean.TRUE.equals(dto.getIsDraft()) ? 0 : 1);
```

**é—®é¢˜æè¿°**ï¼š
- å¦‚æœå‰ç«¯ä¼ å…¥ `isDraft=false`ï¼ŒåˆåŒç›´æ¥å˜ä¸º"å®¡æ‰¹ä¸­(1)"çŠ¶æ€
- ä½†æ­¤æ—¶**å¹¶æ²¡æœ‰åˆ›å»ºå·¥ä½œæµå®ä¾‹**
- å¯¼è‡´åˆåŒçŠ¶æ€ä¸å®é™…æµç¨‹ä¸¥é‡ä¸ä¸€è‡´

**å½±å“**ï¼š
- æ•°æ®åº“ä¸­å‡ºç°"å¹½çµå®¡æ‰¹"çŠ¶æ€çš„åˆåŒ
- æ— æ³•é€šè¿‡ `WorkflowController.submit()` å†æ¬¡æäº¤ï¼ˆçŠ¶æ€æ£€æŸ¥ä¼šå¤±è´¥ï¼‰
- å¯èƒ½å¯¼è‡´åˆåŒæ°¸è¿œå¡åœ¨å®¡æ‰¹ä¸­çŠ¶æ€

**ä¿®å¤å»ºè®®**ï¼š
```java
// åˆ›å»ºåˆåŒæ—¶ç»Ÿä¸€è®¾ä¸ºè‰ç¨¿
contract.setStatus(0);
// æäº¤å®¡æ‰¹ç»Ÿä¸€é€šè¿‡ WorkflowController.submit() è¿›è¡Œ
```

---

### 2. æƒé™ç³»ç»Ÿç©ºæ¶å­

**ä½ç½®**ï¼š
- `SecurityConfig.java` Line 27, 38, 49
- å„ Controller çš„ `@PreAuthorize` æ³¨è§£

```java
@PreAuthorize("hasAuthority('contract:add')")
public Result<Long> create(@RequestBody ContractDTO contractDTO) { ... }
```

**é—®é¢˜æè¿°**ï¼š
- ä»£ç ä¸­ä½¿ç”¨äº† `hasAuthority()` æƒé™æ£€æŸ¥
- ä½†æ•°æ®åº“ä¸­**æ²¡æœ‰æƒé™è¡¨**ï¼ˆ`sys_permission`, `sys_role_permission` ç­‰ï¼‰
- è™½ç„¶æœ‰ `SysPermission`, `SysRolePermission` å®ä½“ç±»ï¼Œä½†æœªå»ºè¡¨
- è™½ç„¶æœ‰å¯¹åº”çš„ Mapperï¼Œä½†æ— æ³•æŸ¥è¯¢æ•°æ®

**å½±å“**ï¼š
- å½“å‰æ‰€æœ‰éœ€è¦æƒé™çš„æ¥å£éƒ½ä¼š**æŠ¥é”™æˆ–è¢«æ‹¦æˆª**
- æƒé™æ³¨è§£å½¢åŒè™šè®¾

**ä¿®å¤å»ºè®®**ï¼š
1. è¡¥å……æƒé™è¡¨çš„ SQL å»ºè¡¨è¯­å¥
2. åˆå§‹åŒ–è§’è‰²-æƒé™æ•°æ®
3. å®ç° `UserDetailsService` åŠ è½½ç”¨æˆ·æƒé™

---

### 3. å·¥ä½œæµå®¡æ‰¹äººæŸ¥è¯¢é€»è¾‘å¯èƒ½è¿”å›ç©º

**ä½ç½®**ï¼š`WorkflowServiceImpl.findApprover()` Line 168-174

```java
List<SysUser> users = userMapper.selectList(new LambdaQueryWrapper<SysUser>()
        .eq(SysUser::getRole, roleCode));

if (users.isEmpty()) {
    throw new RuntimeException("æµè½¬å¤±è´¥ï¼šç³»ç»Ÿä¸­æ‰¾ä¸åˆ°è§’è‰²ä¸º " + roleCode + " çš„ç”¨æˆ·");
}
return users.get(0).getId(); // æ´¾ç»™ç¬¬ä¸€ä¸ªäºº
```

**é—®é¢˜æè¿°**ï¼š
- å¦‚æœ `users` ä¸ä¸ºç©ºï¼Œä½† `users.get(0)` è¿”å› `null`
- æˆ–è€… `users.get(0).getId()` è¿”å› `null`
- æ²¡æœ‰å¯¹è¿™äº›æƒ…å†µè¿›è¡Œæ£€æŸ¥

**å½±å“**ï¼š
- å¯èƒ½åˆ›å»º `approver_id` ä¸º `null` çš„ä»»åŠ¡
- å¯¼è‡´ä»»åŠ¡æ— æ³•è¢«ä»»ä½•äººå¤„ç†

**ä¿®å¤å»ºè®®**ï¼š
```java
SysUser user = users.get(0);
if (user == null || user.getId() == null) {
    throw new RuntimeException("æµè½¬å¤±è´¥ï¼šç”¨æˆ·æ•°æ®å¼‚å¸¸");
}
return user.getId();
```

---

### 4. äº‹åŠ¡è¾¹ç•Œä¸å®Œæ•´

**ä½ç½®**ï¼š`ContractServiceImpl` å…¨éƒ¨æ–¹æ³•

```java
@Service
public class ContractServiceImpl extends ServiceImpl<ContractMapper, Contract> 
        implements ContractService {
    
    @Override
    public Long createContract(ContractDTO dto) {
        // ... å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
        this.save(contract); // æ•°æ®åº“æ“ä½œ
        return contract.getId();
    }
}
```

**é—®é¢˜æè¿°**ï¼š
- `ContractServiceImpl` çš„æ‰€æœ‰æ–¹æ³•éƒ½**æ²¡æœ‰ `@Transactional` æ³¨è§£**
- è€Œ `WorkflowServiceImpl` ä½¿ç”¨äº† `@Transactional`
- å¦‚æœåç»­åœ¨ `ContractServiceImpl` ä¸­è°ƒç”¨å¤šä¸ªæ•°æ®åº“æ“ä½œï¼Œå¯èƒ½å‡ºç°éƒ¨åˆ†å¤±è´¥

**å½±å“**ï¼š
- æ•°æ®ä¸€è‡´æ€§æ— æ³•ä¿è¯
- ä¾‹å¦‚ï¼šåˆ›å»ºåˆåŒæˆåŠŸï¼Œä½†åˆ›å»ºå…³è”æ•°æ®å¤±è´¥ï¼Œæ— æ³•å›æ»š

**ä¿®å¤å»ºè®®**ï¼š
```java
@Override
@Transactional(rollbackFor = Exception.class)
public Long createContract(ContractDTO dto) { ... }
```

---

## ğŸŸ  ä¸­ç­‰é—®é¢˜ï¼ˆMajorï¼‰

### 5. å¼‚å¸¸å¤„ç†è¿‡äºç®€å•

**ä½ç½®**ï¼šå¤šå¤„ä»£ç 

```java
if (contract == null) {
    throw new RuntimeException("åˆåŒä¸å­˜åœ¨");
}

if (task == null) throw new RuntimeException("ä»»åŠ¡ä¸å­˜åœ¨");
```

**é—®é¢˜æè¿°**ï¼š
- æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸éƒ½æŠ› `RuntimeException`
- å‰ç«¯æ— æ³•åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ï¼ˆ404ã€403ã€400ç­‰ï¼‰
- å¼‚å¸¸ä¿¡æ¯ä¸è§„èŒƒ

**å½±å“**ï¼š
- å‰ç«¯é”™è¯¯å¤„ç†å›°éš¾
- æ—¥å¿—ä¸­éš¾ä»¥å®šä½é—®é¢˜
- ç”¨æˆ·ä½“éªŒå·®

**ä¿®å¤å»ºè®®**ï¼š
```java
// å®šä¹‰ä¸šåŠ¡å¼‚å¸¸
public class BusinessException extends RuntimeException {
    private int code;
    public BusinessException(int code, String message) { ... }
}

// ä½¿ç”¨
if (contract == null) {
    throw new BusinessException(404, "åˆåŒä¸å­˜åœ¨");
}
```

---

### 6. å·¥ä½œæµæµè½¬é€»è¾‘ç¼ºå°‘åˆ†æ”¯åˆ¤æ–­

**ä½ç½®**ï¼š`WorkflowServiceImpl.toNextNode()` Line 117-123

```java
WfTransition transition = transitionMapper.selectOne(new LambdaQueryWrapper<WfTransition>()
        .eq(WfTransition::getFromNodeId, currentNode.getId()));

if (transition == null) {
    throw new RuntimeException("æµç¨‹ä¸­æ–­ï¼šæ‰¾ä¸åˆ°ä¸‹ä¸€èŠ‚ç‚¹");
}
```

**é—®é¢˜æè¿°**ï¼š
- æŸ¥è¯¢è¿çº¿æ—¶**æ²¡æœ‰è€ƒè™‘æ¡ä»¶è¡¨è¾¾å¼** (`condition_expr`)
- å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šæ¡å‡ºçº¿ï¼ˆæ¯”å¦‚æ ¹æ®é‡‘é¢èµ°ä¸åŒåˆ†æ”¯ï¼‰ï¼Œä¼šéšæœºé€‰ä¸€æ¡
- `selectOne()` åœ¨æœ‰å¤šæ¡è®°å½•æ—¶ä¼šæŠ¥é”™

**å½±å“**ï¼š
- æ— æ³•å®ç°æ¡ä»¶åˆ†æ”¯æµç¨‹
- å¤æ‚æµç¨‹ä¼šæŠ¥é”™

**ä¿®å¤å»ºè®®**ï¼š
```java
List<WfTransition> transitions = transitionMapper.selectList(
    new LambdaQueryWrapper<WfTransition>()
        .eq(WfTransition::getFromNodeId, currentNode.getId())
);

// æ ¹æ® condition_expr ç­›é€‰æ»¡è¶³æ¡ä»¶çš„è¿çº¿
WfTransition transition = evaluateConditions(transitions, instance);
```

---

### 7. ç”¨æˆ·IDè·å–é€»è¾‘é‡å¤ä¸”è„†å¼±

**ä½ç½®**ï¼š
- `ContractServiceImpl.getCurrentUserId()` Line 114-126
- `WorkflowController.getCurrentUserId()` Line 69-74

```java
private Long getCurrentUserId() {
    Authentication auth = SecurityContextHolder.getContext().getAuthentication();
    if (auth == null) {
        throw new RuntimeException("æœªç™»å½•");
    }
    String username = (String) auth.getPrincipal();
    SysUser user = userMapper.selectOne(new LambdaQueryWrapper<SysUser>()
        .eq(SysUser::getUsername, username));
    if (user == null) {
        throw new RuntimeException("ç”¨æˆ·æ•°æ®å¼‚å¸¸");
    }
    return user.getId();
}
```

**é—®é¢˜æè¿°**ï¼š
- åŒæ ·çš„é€»è¾‘åœ¨ä¸¤ä¸ªç±»ä¸­é‡å¤
- æ¯æ¬¡éƒ½è¦æŸ¥æ•°æ®åº“ï¼Œæ€§èƒ½å·®
- å¦‚æœ `auth.getPrincipal()` ä¸æ˜¯ `String` ç±»å‹ä¼šå¼ºè½¬å¤±è´¥

**å½±å“**ï¼š
- ä»£ç å†—ä½™
- æ€§èƒ½é—®é¢˜
- ç±»å‹è½¬æ¢å¼‚å¸¸é£é™©

**ä¿®å¤å»ºè®®**ï¼š
```java
// åˆ›å»ºå·¥å…·ç±»
@Component
public class SecurityUtils {
    
    @Autowired
    private SysUserMapper userMapper;
    
    private static final ThreadLocal<Long> userIdCache = new ThreadLocal<>();
    
    public Long getCurrentUserId() {
        // ä½¿ç”¨ThreadLocalç¼“å­˜ï¼Œé¿å…é‡å¤æŸ¥è¯¢
        Long userId = userIdCache.get();
        if (userId != null) return userId;
        
        // å®é™…æŸ¥è¯¢é€»è¾‘
        // ...
        userIdCache.set(userId);
        return userId;
    }
}
```

---

### 8. AIæœåŠ¡ç«¯å£é…ç½®ä¸ä¸€è‡´

**ä½ç½®**ï¼š
- `application.properties` Line 40: `ai.service.base-url=http://localhost:8765`
- `ai-service/main.py` Line 402-406: é»˜è®¤ç«¯å£ `8000`
- æ–‡æ¡£ä¸­æåˆ° `8002`

**é—®é¢˜æè¿°**ï¼š
- é…ç½®å’Œå®é™…ç«¯å£ä¸ä¸€è‡´
- å®¹æ˜“å¯¼è‡´æœåŠ¡æ— æ³•è¿æ¥

**å½±å“**ï¼š
- AIåŠŸèƒ½è°ƒç”¨å¤±è´¥
- æ’æŸ¥å›°éš¾

**ä¿®å¤å»ºè®®**ï¼š
- ç»Ÿä¸€ä½¿ç”¨ 8765 ç«¯å£
- æˆ–å°†ç«¯å£é…ç½®å¤–éƒ¨åŒ–ï¼ˆç¯å¢ƒå˜é‡ï¼‰

---

### 9. JSONå­—æ®µæ˜ å°„å¯èƒ½å¤±è´¥

**ä½ç½®**ï¼š`Contract.java` Line 50-51

```java
@TableField(typeHandler = Fastjson2TypeHandler.class)
private Map<String, Object> attributes;
```

**é—®é¢˜æè¿°**ï¼š
- ä½¿ç”¨äº† `Fastjson2TypeHandler`
- ä½†éœ€è¦åœ¨ MyBatis-Plus ä¸­é…ç½® `autoResultMap = true`
- `@TableName` æ³¨è§£ä¸­å·²é…ç½®ï¼Œä½†å®¹æ˜“é—æ¼

**å½±å“**ï¼š
- æŸ¥è¯¢æ—¶ `attributes` å¯èƒ½ä¸º `null`
- å†™å…¥æ—¶å¯èƒ½æŠ¥é”™

**ä¿®å¤å»ºè®®**ï¼š
- ç¡®ä¿ `@TableName(value = "t_contract", autoResultMap = true)` æ­£ç¡®é…ç½®
- æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯

---

## ğŸŸ¡ è½»å¾®é—®é¢˜ï¼ˆMinorï¼‰

### 10. åˆåŒç¼–å·ç”Ÿæˆå¯èƒ½é‡å¤

**ä½ç½®**ï¼š`ContractServiceImpl.createContract()` Line 46-48

```java
String timeStr = LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyyMMddHHmmss"));
String contractNo = "HT-" + dto.getType() + "-" + timeStr;
contract.setContractNo(contractNo);
```

**é—®é¢˜æè¿°**ï¼š
- å¦‚æœåœ¨åŒä¸€ç§’å†…åˆ›å»ºå¤šä¸ªåˆåŒï¼Œç¼–å·ä¼šé‡å¤
- è™½ç„¶æ•°æ®åº“æœ‰å”¯ä¸€é”®çº¦æŸï¼Œä½†ä¼šå¯¼è‡´ç¬¬äºŒä¸ªåˆåŒåˆ›å»ºå¤±è´¥

**å½±å“**ï¼š
- é«˜å¹¶å‘åœºæ™¯ä¸‹åˆåŒåˆ›å»ºå¤±è´¥ç‡é«˜

**ä¿®å¤å»ºè®®**ï¼š
```java
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨çº³ç§’
String timeStr = String.valueOf(System.nanoTime());

// æ–¹æ¡ˆ2ï¼šä½¿ç”¨UUID
String contractNo = "HT-" + dto.getType() + "-" + UUID.randomUUID().toString().substring(0, 8);

// æ–¹æ¡ˆ3ï¼šä½¿ç”¨æ•°æ®åº“åºåˆ—æˆ–Redisè‡ªå¢
```

---

### 11. åˆ†é¡µæŸ¥è¯¢ç¼ºå°‘æ€»æ•°ä¼˜åŒ–

**ä½ç½®**ï¼š`ContractServiceImpl.getContractPage()` Line 97-109

```java
@Override
public IPage<Contract> getContractPage(int pageNum, int pageSize, String name, String type) {
    Page<Contract> page = new Page<>(pageNum, pageSize);
    // ... æŸ¥è¯¢é€»è¾‘
    return this.page(page, wrapper);
}
```

**é—®é¢˜æè¿°**ï¼š
- MyBatis-Plus é»˜è®¤æ¯æ¬¡åˆ†é¡µéƒ½ä¼šæŸ¥è¯¢æ€»æ•°ï¼ˆCOUNTï¼‰
- å¯¹äºå¤§æ•°æ®é‡è¡¨ï¼Œæ€§èƒ½è¾ƒå·®

**å½±å“**ï¼š
- åˆ—è¡¨æŸ¥è¯¢å˜æ…¢

**ä¿®å¤å»ºè®®**ï¼š
```java
// å¦‚æœä¸éœ€è¦ç²¾ç¡®æ€»æ•°ï¼Œå¯ä»¥ä¼˜åŒ–
Page<Contract> page = new Page<>(pageNum, pageSize, false); // å…³é—­countæŸ¥è¯¢
```

---

### 12. åˆ é™¤æ“ä½œç¼ºå°‘çº§è”æ£€æŸ¥

**ä½ç½®**ï¼š`ContractController.delete()` Line 77-95

```java
@DeleteMapping("/{id}")
public Result<Boolean> delete(@PathVariable Long id) {
    // ... çŠ¶æ€æ£€æŸ¥
    boolean success = contractService.removeById(id);
    return Result.success(success);
}
```

**é—®é¢˜æè¿°**ï¼š
- åˆ é™¤åˆåŒå‰æ²¡æœ‰æ£€æŸ¥æ˜¯å¦æœ‰å…³è”çš„å·¥ä½œæµå®ä¾‹
- ç›´æ¥ç‰©ç†åˆ é™¤å¯èƒ½å¯¼è‡´æ•°æ®å­¤å„¿

**å½±å“**ï¼š
- æ•°æ®å®Œæ•´æ€§é—®é¢˜
- å¯èƒ½äº§ç”Ÿæ— æ•ˆçš„æµç¨‹å®ä¾‹å¼•ç”¨

**ä¿®å¤å»ºè®®**ï¼š
```java
// æ£€æŸ¥æ˜¯å¦æœ‰å·¥ä½œæµå®ä¾‹
Long instanceCount = workflowInstanceMapper.selectCount(
    new LambdaQueryWrapper<WfInstance>().eq(WfInstance::getContractId, id)
);
if (instanceCount > 0) {
    return Result.error("è¯¥åˆåŒå­˜åœ¨å®¡æ‰¹è®°å½•ï¼Œä¸èƒ½åˆ é™¤");
}

// æˆ–è€…æ”¹ä¸ºé€»è¾‘åˆ é™¤
```

---

### 13. åˆåŒé‡‘é¢ç±»å‹å¯èƒ½æº¢å‡º

**ä½ç½®**ï¼š`Contract.java` Line 37

```java
private BigDecimal amount;
```

**é—®é¢˜æè¿°**ï¼š
- ä½¿ç”¨ `BigDecimal` æ˜¯æ­£ç¡®çš„
- ä½†åœ¨æ•°æ®åº“ä¸­å®šä¹‰ä¸º `decimal(18,2)`
- å¯¹äºå¤§å‹ç”µä¿¡åˆåŒï¼ˆå¯èƒ½ä¸Šäº¿ï¼‰ï¼Œ18ä½å¯èƒ½ä¸å¤Ÿ

**å½±å“**ï¼š
- è¶…å¤§é‡‘é¢åˆåŒæ— æ³•å­˜å‚¨

**ä¿®å¤å»ºè®®**ï¼š
```sql
-- å»ºè®®è°ƒæ•´ä¸º
`amount` decimal(20,2) DEFAULT '0.00'
```

---

### 14. æ—¥å¿—çº§åˆ«é…ç½®ä¸åˆç†

**ä½ç½®**ï¼š`application.properties` Line 36

```java
logging.level.com.software.contract=debug
```

**é—®é¢˜æè¿°**ï¼š
- ç”Ÿäº§ç¯å¢ƒåº”è¯¥ç”¨ `info` æˆ– `warn`
- `debug` ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œå½±å“æ€§èƒ½

**å½±å“**ï¼š
- ç£ç›˜ç©ºé—´å ç”¨
- æ—¥å¿—å¤ªå¤šåè€Œéš¾ä»¥æ’æŸ¥é—®é¢˜

**ä¿®å¤å»ºè®®**ï¼š
```properties
# å¼€å‘ç¯å¢ƒ
logging.level.com.software.contract_system=debug

# ç”Ÿäº§ç¯å¢ƒ
# logging.level.com.software.contract_system=info
```

---

### 15. AIæœåŠ¡è¶…æ—¶æ—¶é—´å¯èƒ½ä¸å¤Ÿ

**ä½ç½®**ï¼š`AIServiceImpl` Line 34, 49

```java
.timeout(Duration.ofSeconds(30))
```

**é—®é¢˜æè¿°**ï¼š
- AIç”Ÿæˆæ¡æ¬¾å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
- 30ç§’åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¸å¤Ÿ
- RAGæ£€ç´¢ + LLMç”Ÿæˆå¯èƒ½è¶…æ—¶

**å½±å“**ï¼š
- ç”¨æˆ·ä½“éªŒå·®
- åŠŸèƒ½ä¸å¯ç”¨

**ä¿®å¤å»ºè®®**ï¼š
```java
// æ ¹æ®ä¸åŒåœºæ™¯è®¾ç½®ä¸åŒè¶…æ—¶
// ç”Ÿæˆæ¡æ¬¾ï¼š60ç§’
.timeout(Duration.ofSeconds(60))

// åˆè§„æ£€æŸ¥ï¼š45ç§’
.timeout(Duration.ofSeconds(45))

// æˆ–é…ç½®åˆ°application.properties
```

---

## ğŸŸ¢ ä»£ç è§„èŒƒå»ºè®®ï¼ˆInfoï¼‰

### 16. é­”æ³•å€¼åº”è¯¥å¸¸é‡åŒ–

**ä½ç½®**ï¼šå¤šå¤„

```java
contract.setStatus(0); // è‰ç¨¿
contract.setStatus(1); // å®¡æ‰¹ä¸­
contract.setStatus(2); // å·²ç”Ÿæ•ˆ
contract.setStatus(3); // å·²é©³å›
```

**å»ºè®®**ï¼š
```java
public class ContractStatus {
    public static final int DRAFT = 0;
    public static final int APPROVING = 1;
    public static final int EFFECTIVE = 2;
    public static final int REJECTED = 3;
}

// ä½¿ç”¨
contract.setStatus(ContractStatus.DRAFT);
```

---

### 17. Controllerè¿”å›ç±»å‹ä¸ç»Ÿä¸€

**ä½ç½®**ï¼š
- `ContractController` è¿”å› `Result<T>`
- `AIController` è¿”å› `Mono<AIResponse<T>>`

**å»ºè®®**ï¼š
- ç»Ÿä¸€ä½¿ç”¨ `Result<T>` ä½œä¸ºå“åº”
- AIæœåŠ¡çš„å“åº”å¼ç‰¹æ€§åœ¨Serviceå±‚å¤„ç†

---

### 18. ç¼ºå°‘æ¥å£æ–‡æ¡£è¯¦ç»†è¯´æ˜

**ä½ç½®**ï¼šå„Controller

```java
@Operation(summary = "åˆ›å»ºåˆåŒ", description = "åˆ›å»ºæ–°åˆåŒæˆ–ä¿å­˜è‰ç¨¿")
```

**å»ºè®®**ï¼š
- è¡¥å……è¯·æ±‚å‚æ•°ç¤ºä¾‹
- è¡¥å……å“åº”ç¤ºä¾‹
- è¡¥å……é”™è¯¯ç è¯´æ˜

---

## ğŸ“Š é—®é¢˜ç»Ÿè®¡

| ä¸¥é‡ç­‰çº§ | æ•°é‡ | å æ¯” |
|---------|------|------|
| ğŸ”´ ä¸¥é‡ï¼ˆCriticalï¼‰ | 4 | 22% |
| ğŸŸ  ä¸­ç­‰ï¼ˆMajorï¼‰ | 6 | 33% |
| ğŸŸ¡ è½»å¾®ï¼ˆMinorï¼‰ | 6 | 33% |
| ğŸŸ¢ å»ºè®®ï¼ˆInfoï¼‰ | 3 | 17% |
| **æ€»è®¡** | **18** | **100%** |

---

## ğŸ¯ ä¼˜å…ˆä¿®å¤å»ºè®®

### ç«‹å³ä¿®å¤ï¼ˆæœ¬å‘¨å†…ï¼‰
1. âœ… **é—®é¢˜1**: ä¿®å¤åˆåŒçŠ¶æ€ä¸å·¥ä½œæµä¸ä¸€è‡´
2. âœ… **é—®é¢˜2**: è¡¥å……æƒé™è¡¨ç»“æ„
3. âœ… **é—®é¢˜4**: æ·»åŠ äº‹åŠ¡æ³¨è§£

### è¿‘æœŸä¿®å¤ï¼ˆä¸‹å‘¨å†…ï¼‰
4. âœ… **é—®é¢˜5**: å®šä¹‰ç»Ÿä¸€ä¸šåŠ¡å¼‚å¸¸
5. âœ… **é—®é¢˜7**: æå–ç”¨æˆ·IDè·å–é€»è¾‘
6. âœ… **é—®é¢˜8**: ç»Ÿä¸€AIæœåŠ¡ç«¯å£

### æŒç»­ä¼˜åŒ–
7. ä»£ç å®¡æŸ¥æœºåˆ¶
8. å•å…ƒæµ‹è¯•è¦†ç›–
9. æ€§èƒ½æµ‹è¯•

---

## âœ… æ€»ä½“è¯„ä»·

### ä¼˜ç‚¹
- âœ… é¡¹ç›®ç»“æ„æ¸…æ™°ï¼Œåˆ†å±‚åˆç†
- âœ… ä½¿ç”¨äº†ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆ
- âœ… æ ¸å¿ƒä¸šåŠ¡æµç¨‹åŸºæœ¬å®ç°
- âœ… ä»£ç å¯è¯»æ€§è¾ƒå¥½

### å¾…æ”¹è¿›
- âš ï¸ ç¼ºå°‘å¼‚å¸¸å¤„ç†æœºåˆ¶
- âš ï¸ äº‹åŠ¡ç®¡ç†ä¸å®Œæ•´
- âš ï¸ æƒé™ç³»ç»Ÿæœªå®Œæˆ
- âš ï¸ ç¼ºå°‘å•å…ƒæµ‹è¯•

### å»ºè®®
å»ºè®®åœ¨ç»§ç»­å¼€å‘æ–°åŠŸèƒ½å‰ï¼Œå…ˆä¿®å¤ä¸Šè¿°4ä¸ªä¸¥é‡é—®é¢˜ï¼Œç¡®ä¿å·²æœ‰ä»£ç çš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

---

**æ£€æŸ¥äººå‘˜**ï¼šAIåŠ©æ‰‹  
**å®¡æ ¸çŠ¶æ€**ï¼šå¾…å¼€å‘å›¢é˜Ÿç¡®è®¤  
**åç»­è·Ÿè¿›**ï¼šå»ºè®®æ¯å‘¨è¿›è¡Œä¸€æ¬¡ä»£ç å®¡æŸ¥

