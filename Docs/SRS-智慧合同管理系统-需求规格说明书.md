# 智慧合同管理系统 - 软件需求规格说明书 (SRS)

> **文档版本**: v1.0  
> **编写日期**: 2025年11月  
> **项目名称**: 智慧合同管理系统 (Intelligent Contract Management System)  
> **文档状态**: 正式发布

---

## 文档修订历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| v0.1 | 2024-11-10 | 项目组 | 初始草稿 |
| v1.0 | 2024-11-19 | 项目组 | 正式版本，经过评审 |

---

## 目录

1. [引言](#1-引言)
2. [综合描述](#2-综合描述)
3. [需求获取与分析方法](#3-需求获取与分析方法)
4. [功能需求](#4-功能需求)
5. [外部接口需求](#5-外部接口需求)
6. [非功能需求](#6-非功能需求)
7. [数据需求](#7-数据需求)
8. [需求追踪矩阵](#8-需求追踪矩阵)
9. [附录](#9-附录)

---

## 1. 引言

### 1.1 编写目的

本软件需求规格说明书（SRS）旨在明确智慧合同管理系统的功能需求、性能需求和约束条件，为后续的系统设计、开发、测试和验收提供依据。

**预期读者**：
- 项目开发团队成员
- 项目管理人员
- 课程指导教师
- 系统测试人员

### 1.2 项目背景

**项目来源**：软件工程课程项目二

**业务背景**：  
工程建设项目的合同管理是一个复杂的法律与业务管理过程，涉及合同订立、履行、变更、监控等多个环节。传统的人工管理方式存在以下痛点：

1. **审批流程僵化**：无法根据合同金额动态调整审批路径
2. **风险识别困难**：人工审查合同条款耗时长、易遗漏
3. **付款监控缺失**：容易出现超额支付的风险
4. **信息追溯困难**：合同变更历史不清晰，责任难以界定

**项目目标**：  
开发一套智能化的合同管理系统，重点解决以下两大核心问题：
- **合同内容规范生成**：通过AI辅助和智能审查，确保合同内容合规
- **工程进度款监控**：通过自动化预警，防止超额支付风险

### 1.3 术语定义和缩略语

| 术语/缩略语 | 定义 |
|------------|------|
| SRS | Software Requirements Specification，软件需求规格说明书 |
| RBAC | Role-Based Access Control，基于角色的访问控制 |
| LLM | Large Language Model，大语言模型 |
| AI | Artificial Intelligence，人工智能 |
| 履约保证金 | 承包方向发包方缴纳的保证金，用于保证合同履行，本系统中为中标价的10% |
| 分级审批 | 根据合同金额大小，分为科员、科长、处长、局长四个审批级别 |
| 超额支付 | 支付的进度款金额超过已完工部分对应的批复概算 |
| 工作流实例 | 一个正在执行的审批流程的实例 |

### 1.4 参考资料

1. 课程项目题目文档《软件工程课程项目工作指南》
2. IEEE 830-1998: IEEE Recommended Practice for Software Requirements Specifications
3. GB/T 9385-2008: 软件工程 软件生存周期过程
4. ISO/IEC 25010: 系统与软件质量模型

---

## 2. 综合描述

### 2.1 产品概述

智慧合同管理系统是一个面向工程建设行业的合同全生命周期管理平台，通过人工智能技术和自动化工作流，实现合同的智能起草、动态审批、风险审查和进度款监控。

**核心价值主张**：
1. **提升效率**：AI辅助合同起草，减少70%的人工填写时间
2. **降低风险**：AI风险审查+超额预警，防止合规和资金风险
3. **增强透明**：完整的操作日志和审计追踪，责任可追溯
4. **灵活适配**：动态审批流程，根据业务规则自动匹配

### 2.2 产品功能概览

系统功能分为三层架构：

```
【基础设施层】
├── 用户认证与权限管理（RBAC）
├── 组织架构管理
├── 文件存储与版本控制
└── 操作日志与审计

【核心业务层】
├── 合同生命周期管理
│   ├── AI辅助合同起草
│   ├── 动态分级审批流程
│   ├── AI风险审查
│   └── 合同变更管理
└── 工程进度款监控
    ├── 付款计划与进度关联
    ├── 超额预警与拦截
    └── 履约保证金管理

【智能增强层】
├── AI合同生成服务
├── AI风险审查服务
├── 自动化通知与提醒
└── 数据可视化Dashboard
```

### 2.3 用户特征

| 用户角色 | 职责 | 技术水平 | 使用频率 |
|---------|------|---------|---------|
| 项目经办人员 | 创建合同、申请付款 | 中等 | 每日 |
| 法务人员 | 审查合同法律风险 | 较高 | 每日 |
| 财务人员 | 审核付款申请 | 中等 | 每日 |
| 审批领导 | 审批合同和付款 | 较低 | 每日 |
| 系统管理员 | 系统配置、用户管理 | 高 | 每周 |

### 2.4 运行环境

**客户端环境**：
- 操作系统：Windows 10+、macOS 10.15+
- 浏览器：Chrome 90+、Edge 90+、Firefox 88+
- 分辨率：最小1366×768，推荐1920×1080

**服务端环境**：
- 操作系统：Linux (Ubuntu 20.04+ / CentOS 7+)
- Java运行环境：JDK 17+
- 数据库：MySQL 8.0+
- 缓存：Redis 7.0+
- 文件存储：MinIO / 阿里云OSS

**网络环境**：
- 内网部署，支持VPN远程访问
- 需要访问外部LLM API（文心一言/通义千问）

### 2.5 设计和实现约束

| 约束类型 | 约束内容 |
|---------|---------|
| 技术约束 | 前端使用Vue 3，后端使用Spring Boot 3 |
| 业务规则约束 | 合同金额必须与中标价一致；履约保证金必须为中标价的10% |
| 法规约束 | 必须符合《中华人民共和国民法典》中关于合同的规定 |
| 安全约束 | 数据传输必须使用HTTPS；敏感信息必须加密存储 |
| 时间约束 | 项目开发周期为3个月 |
| 成本约束 | LLM API调用需控制在免费额度内 |

### 2.6 假设和依赖

**假设**：
1. 组织架构中每个用户都已正确配置直属上级
2. 用户具备基本的计算机操作能力
3. LLM API服务稳定可用（允许短暂不可用）
4. 网络环境稳定

**依赖**：
1. 依赖第三方LLM API服务（文心一言/通义千问）
2. 依赖对象存储服务（MinIO/阿里云OSS）
3. 依赖邮件服务器（用于发送通知邮件）

---

## 3. 需求获取与分析方法

本章体现了系统化的需求工程方法论，是软件工程理论在实践中的应用。

### 3.1 需求获取方法

#### 3.1.1 文档分析法

**方法描述**：  
通过深入分析课程项目题目文档，系统地提取功能需求和业务约束。

**实施过程**：

1. **关键词提取**：识别题目中的核心概念
   - 核心场景：合同规范生成、进度款监控
   - 业务规则：履约保证金10%、四级审批、超额预警
   - 技术要求：AI应用、自动化、数字化

2. **需求转化**：将题目原文转化为结构化需求

| 题目原文 | 需求ID | 需求陈述 | 类型 |
|---------|--------|---------|------|
| "分级审批程序(科员、科长、处长和局长)" | FR-001 | 系统应支持四级分级审批流程 | 功能需求 |
| "按变更金额分为5万元以下..." | FR-002 | 系统应根据合同金额自动匹配审批路径 | 功能需求 |
| "支付进度款金额不得突破已完工部分..." | FR-003 | 系统应在付款申请时校验金额，超额则拦截 | 功能需求 |
| "履约保证金制度(中标价的10%)" | FR-004 | 系统应自动计算并管理履约保证金 | 功能需求 |
| "AI应用" | FR-005 | 系统应提供AI辅助合同生成功能 | 功能需求 |
| "AI应用" | FR-006 | 系统应提供AI合同风险审查功能 | 功能需求 |

3. **隐含需求识别**：  
题目未明确但业务必需的需求：
   - 用户认证与权限管理
   - 操作日志与审计追踪
   - 合同版本控制
   - 通知与提醒机制

**成果**：识别出35个功能需求、18个非功能需求

#### 3.1.2 用例驱动法

**方法描述**：  
通过识别系统参与者（Actor）和用例（Use Case），建立系统功能模型。

**实施过程**：

1. **参与者识别**

| 参与者类型 | 参与者名称 | 说明 |
|-----------|-----------|------|
| 主要参与者 | 项目经办人员 | 创建和提交合同 |
| 主要参与者 | 法务人员 | 审查合同法律风险 |
| 主要参与者 | 财务人员 | 审核付款申请 |
| 主要参与者 | 审批领导 | 审批合同和付款 |
| 主要参与者 | 系统管理员 | 管理系统配置 |
| 次要参与者 | LLM API | 提供AI生成和审查服务 |
| 次要参与者 | 对象存储服务 | 存储合同文件 |

2. **用例识别**（共18个核心用例）

| 用例ID | 用例名称 | 主要参与者 | 优先级 |
|--------|---------|-----------|-------|
| UC-01 | 创建合同 | 项目经办人员 | P0 |
| UC-02 | 提交合同审批 | 项目经办人员 | P0 |
| UC-03 | 审批合同 | 审批领导 | P0 |
| UC-04 | AI生成合同草稿 | 项目经办人员 | P1 |
| UC-05 | AI风险审查 | 法务人员 | P1 |
| UC-06 | 申请进度款 | 项目经办人员 | P0 |
| UC-07 | 超额预警拦截 | 系统 | P0 |
| UC-08 | 确认工程进度 | 项目经办人员 | P0 |
| UC-09 | 管理用户权限 | 系统管理员 | P0 |
| UC-10 | 查询合同 | 所有用户 | P0 |

**成果**：用例图（见附录A），18个用例规约

#### 3.1.3 场景分析法

**典型业务场景**：

**场景1：新建工程合同的完整流程**

```
前提：某工程项目中标，合同金额80万元
参与者：项目经办小李、科长、处长、局长、法务小王

流程：
1. 小李登录系统，创建新合同
2. 小李使用AI生成功能，输入工程基本信息
3. 系统调用LLM API，生成合同草稿
4. 小李审阅并修改合同内容，上传招标文件附件
5. 小李提交审批
6. 系统判断金额80万≥50万，自动匹配4级审批路径
7. 系统触发AI风险审查，标记出1处风险条款
8. 系统通知科长审批
9. 科长审批通过，流转至处长
10. 处长审批通过，流转至局长
11. 局长审批通过，合同生效
12. 系统自动计算履约保证金8万元，生成付款计划

价值：整个流程耗时从传统的5天缩短至1天
```

### 3.2 涉众分析

#### 3.2.1 涉众识别与利益分析

| 涉众 | 利益诉求 | 影响程度 | 优先级 |
|------|---------|---------|-------|
| 项目经办人员 | 快速创建合同，审批流程高效 | 高 | 高 |
| 法务人员 | 合同合规，风险可控 | 高 | 高 |
| 财务人员 | 资金安全，付款流程清晰 | 高 | 高 |
| 审批领导 | 决策信息完整，流程可追溯 | 高 | 高 |
| 管理层 | 整体风险可控，数据可分析 | 中 | 中 |

#### 3.2.2 涉众利益冲突与平衡

**冲突1**：效率 vs 风险控制  
- **冲突描述**：项目经办希望快速审批，法务希望充分时间审查
- **平衡策略**：
  - 设置审批时限（48小时），超时自动催办
  - AI辅助审查，提升法务审查效率
  - 小额合同（<5万）简化审批流程

**冲突2**：灵活性 vs 规范性  
- **冲突描述**：用户希望流程灵活，管理层希望流程严格
- **平衡策略**：
  - 动态工作流：基于规则自动匹配流程
  - 预留特殊审批通道（紧急情况）
  - 变更管理机制：支持后续调整

### 3.3 需求优先级划分（MoSCoW方法）

| 优先级 | 含义 | 功能数量 | 示例 |
|-------|------|---------|------|
| Must Have (P0) | 必须实现 | 15个 | 合同CRUD、静态审批流、超额预警 |
| Should Have (P1) | 应该实现 | 12个 | AI生成、AI审查、动态审批路由 |
| Could Have (P2) | 可以实现 | 8个 | 对话式生成、评论功能、高级Dashboard |
| Won't Have (P3) | 暂不实现 | - | 可视化工作流设计器、语义搜索 |

---

## 4. 功能需求

### 4.1 核心场景一：合同生命周期管理

本场景实现题目要求的"合同内容规范生成"核心功能，通过AI技术和自动化工作流，确保合同内容的规范性和合规性。

#### 4.1.1 用例：创建合同（基础表单方式）

**用例ID**：UC-01  
**用例名称**：创建合同（基础表单方式）  
**主要参与者**：项目经办人员  
**优先级**：P0 - 必须实现

**前置条件**：
- PRE-01: 用户已登录系统
- PRE-02: 用户具有"项目经办"角色权限

**基本流程**：
1. 用户点击"创建合同"按钮
2. 系统显示合同创建表单
3. 用户填写合同基本信息：
   - 合同编号（自动生成，可修改）
   - 合同名称
   - 合同类型（施工合同/分包合同）
   - 甲方名称
   - 乙方名称
   - 中标价
   - 合同金额（必须与中标价一致）
   - 签订日期、开始日期、结束日期
4. 系统自动计算履约保证金 = 中标价 × 10%
5. 用户填写合同正文内容
6. 用户上传合同文件（PDF/Word）
7. 用户点击"保存"
8. 系统验证数据完整性和业务规则
9. 系统保存合同，状态设为"草稿"
10. 系统显示成功提示，返回合同列表

**扩展流程**：

**E1: 合同金额与中标价不一致**
- 在步骤8，如果合同金额 ≠ 中标价
- 系统显示错误："合同金额必须与中标价一致"
- 用例返回步骤3

**E2: 必填字段未填写**
- 在步骤8，如果必填字段为空
- 系统高亮显示未填写的字段
- 用例返回步骤3

**E3: 文件格式不支持**
- 在步骤6，如果文件格式不是PDF/Word
- 系统显示错误："仅支持PDF和Word格式"
- 用例返回步骤6

**后置条件**：
- POST-01: 合同记录已创建，状态为"草稿"
- POST-02: 合同文件已上传到对象存储
- POST-03: 操作日志已记录

**业务规则**：
- BR-001: 合同金额必须精确等于中标价
- BR-002: 履约保证金必须为中标价的10%
- BR-003: 合同编号格式为：HT-YYYYMMDD-序号

---

#### 4.1.2 用例：提交合同审批（核心用例）

**用例ID**：UC-02  
**用例名称**：提交合同审批  
**主要参与者**：项目经办人员  
**次要参与者**：工作流引擎、AI服务、通知服务  
**优先级**：P0 - 必须实现

**前置条件**：
- PRE-01: 用户已登录系统
- PRE-02: 用户具有"项目经办"角色权限
- PRE-03: 合同已创建并处于"草稿"状态
- PRE-04: 合同必填字段已完整填写
- PRE-05: 合同金额与中标价一致

**触发条件**：  
用户在合同详情页点击"提交审批"按钮

**基本流程**：

1. 系统检查合同完整性
   - 验证必填字段
   - 验证业务规则（金额一致性、保证金比例）

2. 系统调用工作流路由器，根据合同金额匹配审批路径
   ```
   IF 金额 < 5万：科员审核即可
   IF 5万 ≤ 金额 < 20万：科员 → 科长
   IF 20万 ≤ 金额 < 50万：科员 → 科长 → 处长
   IF 金额 ≥ 50万：科员 → 科长 → 处长 → 局长
   ```

3. 系统创建工作流实例
   - 生成唯一的工作流实例ID
   - 记录开始时间
   - 设置当前节点为第一个审批节点

4. [可选] 系统触发AI风险审查（异步）
   - 调用LLM API进行合同条款分析
   - 识别风险点
   - 生成风险审查报告

5. 系统根据组织架构查找第一级审批人（科员级别）
   - 查询当前用户的直属上级
   - 如果未配置，使用默认审批人

6. 系统创建第一个审批任务
   - 设置审批人
   - 设置任务状态为"待审批"
   - 记录创建时间

7. 系统发送通知
   - 站内消息
   - 邮件提醒
   - 在审批人的"待办事项"中显示

8. 系统更新合同状态为"审批中"

9. 系统记录操作日志

10. 系统显示成功提示："合同已成功提交审批，当前审批人：XXX"

**扩展流程**：

**E1: 合同信息不完整**
- 在步骤1，如果验证失败
- 系统显示具体错误信息
- 阻止提交，用例结束

**E2: 无法找到审批人**
- 在步骤5，如果未配置审批人
- 系统显示错误："未配置审批人，请联系系统管理员"
- 发送告警给管理员
- 合同状态保持"草稿"
- 用例结束

**E3: AI风险审查失败**
- 在步骤4，如果LLM API调用失败或超时（>30秒）
- 系统记录失败日志
- 生成默认提示："AI审查服务暂时不可用，请人工仔细审查"
- 继续执行步骤5（不阻断流程）

**E4: 通知发送失败**
- 在步骤7，如果邮件发送失败
- 系统记录失败日志
- 仅保留站内消息
- 继续执行步骤8（不阻断流程）

**后置条件**：
- POST-01: 合同状态更新为"审批中"
- POST-02: 工作流实例已创建
- POST-03: 第一个审批任务已创建并分配
- POST-04: 审批人收到通知
- POST-05: 操作日志已记录
- POST-06: AI风险审查报告已生成（如果成功）

**业务规则**：
- BR-010: 审批路径一旦确定，中途不可更改
- BR-011: 工作日9:00-18:00提交的审批，应在24小时内流转
- BR-012: 审批任务在节点停留超过48小时，自动催办

**性能需求**：
- NFR-001: 提交审批操作应在2秒内完成响应
- NFR-002: AI风险审查应在30秒内完成或超时降级

---

#### 4.1.3 用例：审批合同

**用例ID**：UC-03  
**用例名称**：审批合同  
**主要参与者**：审批领导（科员/科长/处长/局长）  
**优先级**：P0 - 必须实现

**前置条件**：
- PRE-01: 用户已登录系统
- PRE-02: 用户具有审批权限
- PRE-03: 存在分配给当前用户的待审批任务

**基本流程**：
1. 用户进入"待办事项"页面
2. 系统显示待审批任务列表
3. 用户点击某个任务，查看合同详情
4. 系统显示合同信息、附件、AI风险审查报告
5. 用户审阅合同内容
6. 用户选择审批操作：
   - 通过
   - 驳回
   - 转办（可选）
7. 用户填写审批意见
8. 用户上传附件（可选）
9. 用户点击"提交"
10. 系统更新审批任务状态
11. 系统判断是否为最后一个节点
    - 如果是，更新合同状态为"已通过"或"已驳回"
    - 如果不是，创建下一节点的审批任务
12. 系统发送通知给相关人员
13. 系统记录操作日志
14. 系统显示成功提示

**扩展流程**：

**E1: 选择驳回**
- 在步骤6，用户选择"驳回"
- 系统更新合同状态为"已驳回"
- 系统通知合同创建人
- 工作流实例状态设为"REJECTED"
- 用例结束

**E2: 选择转办**
- 在步骤6，用户选择"转办"
- 系统显示人员选择框
- 用户选择转办目标人员
- 系统将任务转给目标人员
- 系统发送通知
- 用例结束

**后置条件**：
- POST-01: 审批任务状态已更新
- POST-02: 如果通过且为最后节点，合同状态为"已通过"
- POST-03: 如果驳回，合同状态为"已驳回"
- POST-04: 相关人员收到通知
- POST-05: 操作日志已记录

---

#### 4.1.4 用例：AI对话式合同生成 ⭐

**用例ID**：UC-04  
**用例名称**：AI对话式合同生成  
**主要参与者**：项目经办人员  
**次要参与者**：LLM API服务  
**优先级**：P1 - 应该实现（技术亮点）

**前置条件**：
- PRE-01: 用户已登录系统
- PRE-02: LLM API服务可用
- PRE-03: 用户具有合同创建权限

**触发条件**：  
用户在创建合同页面选择"AI辅助生成"方式

**基本流程**：

1. 用户点击"AI辅助生成合同"按钮
2. 系统显示AI对话界面
3. 系统（AI助手）：提问"请告诉我合同的基本信息：项目名称、甲乙方、合同金额等"
4. 用户：输入"某水利工程项目，甲方是XX市水务局，乙方是XX建设集团，合同金额800万元"
5. 系统调用LLM API，解析用户输入，提取结构化信息
6. 系统（AI助手）：确认"我理解您要创建一份施工合同，金额800万元，是否正确？还有其他补充信息吗？"
7. 用户：补充"工期18个月，包含3个付款节点"
8. 系统多轮对话，收集完整信息（3-5轮对话）
9. 系统调用LLM API，基于收集的信息生成完整合同草稿
10. 系统显示生成的合同内容（包括标准条款）
11. 用户审阅合同内容，可以进行修改
12. 用户点击"保存为草稿"或"直接提交审批"
13. 系统保存合同，记录生成日志

**扩展流程**：

**E1: LLM API调用失败**
- 在步骤5或步骤9，如果API调用失败
- 系统显示提示："AI服务暂时不可用，已为您切换到表单模式"
- 自动跳转到基础表单创建页面（UC-01）

**E2: 用户输入信息不完整**
- 在步骤6-8，如果用户未提供关键信息
- AI助手继续追问："还需要知道合同的签订日期和工期"
- 最多追问5轮，如仍不完整，提示用户后续手动补充

**E3: 生成内容不满意**
- 在步骤11，用户对生成内容不满意
- 用户点击"重新生成"
- 系统返回步骤3，重新开始对话

**后置条件**：
- POST-01: 合同草稿已创建
- POST-02: AI生成日志已记录（包括对话轮次、token消耗）
- POST-03: 用户可以继续编辑或提交审批

**业务规则**：
- BR-030: 单次生成的token消耗不得超过4096
- BR-031: AI生成的合同必须由用户确认后才能保存
- BR-032: 生成失败时不阻断业务流程，自动降级到表单模式

**技术实现要点**：
- 使用会话管理保持多轮对话的上下文
- Prompt工程：设计高质量的提示词模板
- 结构化信息提取：使用JSON Schema约束LLM输出格式

---

#### 4.1.5 用例：AI合同风险审查 ⭐

**用例ID**：UC-05  
**用例名称**：AI合同风险审查  
**主要参与者**：法务人员、系统自动触发  
**次要参与者**：LLM API服务  
**优先级**：P1 - 应该实现（技术亮点）

**前置条件**：
- PRE-01: 合同已创建完成
- PRE-02: 合同内容不为空
- PRE-03: LLM API服务可用（可降级）

**触发条件**：  
- 自动触发：合同提交审批时（UC-02步骤4）
- 手动触发：法务人员在审批页面点击"AI风险审查"按钮

**基本流程**：

1. 系统读取合同完整文本内容
2. 系统查询企业合规规则库
   - 例如："禁止出现无限连带责任条款"
   - "必须包含违约责任条款"
   - "付款条件必须与进度挂钩"
3. 系统构建AI审查Prompt，包含：
   - 合同全文
   - 合规规则列表
   - 审查指令
4. 系统调用LLM API进行分析（异步处理）
5. LLM返回结构化的审查结果（JSON格式）：
   ```json
   {
     "risk_level": "MEDIUM",
     "risk_items": [
       {
         "clause": "第8条：发生争议由甲方所在地法院管辖",
         "risk_type": "管辖权约定不公平",
         "severity": "中",
         "suggestion": "建议改为双方协商或合同签订地法院管辖"
       }
     ],
     "compliance_violations": [
       "缺少违约责任条款"
     ],
     "overall_score": 75
   }
   ```
6. 系统解析审查结果，生成风险审查报告
7. 系统在合同详情页标记风险条款（高亮显示）
8. 系统将报告附加到审批流程中
9. 系统发送通知给法务人员："合同已完成AI风险审查，发现2处需关注点"
10. 法务人员查看报告，结合人工判断做出审批决策

**扩展流程**：

**E1: LLM API调用超时或失败**
- 在步骤4，如果API调用超时（>30秒）或失败
- 系统生成默认报告：
  ```
  AI审查服务暂时不可用
  建议人工仔细审查以下方面：
  1. 合同要素完整性
  2. 违约责任条款
  3. 付款条件合理性
  4. 争议解决方式
  ```
- 审批流程正常进行（不阻断）

**E2: 发现高风险条款**
- 在步骤6，如果risk_level为"HIGH"
- 系统在审批流程中显著标记"⚠️ 高风险合同"
- 自动通知法务主管和分管领导
- 审批人必须查看风险报告后才能审批（强制流程）

**E3: 用户对AI建议有异议**
- 法务人员可以标记"此建议不适用"
- 系统记录人工判断结果，用于改进规则库

**后置条件**：
- POST-01: 风险审查报告已生成并保存
- POST-02: 风险条款已在合同中标记
- POST-03: 审查日志已记录（包括AI建议和人工决策）
- POST-04: 相关人员已收到通知

**业务规则**：
- BR-040: 高风险合同必须由法务人员审查后才能通过
- BR-041: AI审查失败不阻断审批流程
- BR-042: 审查报告保留6年，用于事后追溯

**非功能需求**：
- NFR-040: AI审查应在30秒内完成，否则超时降级
- NFR-041: 审查准确率目标≥70%（通过人工反馈持续优化）

---

#### 4.1.6 用例：动态审批流程配置（可选高级功能）

**用例ID**：UC-11  
**用例名称**：配置动态审批流程  
**主要参与者**：系统管理员  
**优先级**：P2 - 可以实现（时间允许）

**说明**：  
此功能为高级功能，建议采用**配置化**而非可视化设计器的方式实现，降低开发难度。

**基础实现方案**（推荐）：
- 使用JSON配置文件定义工作流规则
- 管理员通过表单界面配置审批路径
- 系统根据配置动态生成审批流程

**配置示例**：
```json
{
  "workflow_name": "合同审批流程",
  "rules": [
    {
      "condition": "amount < 50000",
      "approval_path": ["科员", "科长"]
    },
    {
      "condition": "amount >= 50000 AND amount < 200000",
      "approval_path": ["科员", "科长", "处长"]
    },
    {
      "condition": "amount >= 500000",
      "approval_path": ["科员", "科长", "处长", "局长"]
    }
  ]
}
```

**降级实现**（如果P2时间不足）：
- 在代码中硬编码4种审批路径
- 通过if-else逻辑实现金额分级路由
- 预留扩展接口，便于未来升级

---

### 4.2 核心场景二：工程进度款监控

本场景实现题目要求的"工程进度款监控"核心功能，通过自动化预警和触发器机制，确保付款合规性和资金安全。

#### 4.2.1 用例：申请进度款

**用例ID**：UC-06  
**用例名称**：申请进度款  
**主要参与者**：项目经办人员  
**优先级**：P0 - 必须实现

**前置条件**：
- PRE-01: 合同已审批通过并处于"执行中"状态
- PRE-02: 对应的工程进度已确认
- PRE-03: 用户具有"项目经办"角色权限

**基本流程**：
1. 用户进入合同详情页，点击"申请付款"
2. 系统显示付款计划列表和已付款记录
3. 系统计算可申请金额：
   ```
   可申请金额 = 合同总金额 × 已完工进度比例 - 已支付金额
   ```
4. 用户填写付款申请信息：
   - 申请金额
   - 付款原因
   - 关联的里程碑/进度确认单
5. 用户上传支撑材料（进度确认单、验收报告等）
6. 用户点击"提交申请"
7. **系统执行超额检查**：
   ```
   IF 申请金额 > 可申请金额 THEN
       拦截并提示错误
   ELSE
       允许提交
   ```
8. 系统根据申请金额匹配付款审批流程（同合同审批逻辑）
9. 系统创建付款工作流实例
10. 系统创建第一个审批任务
11. 系统发送通知给审批人
12. 系统记录操作日志
13. 系统显示成功提示

**扩展流程**：

**E1: 超额申请被拦截（核心业务规则）**
- 在步骤7，如果申请金额 > 可申请金额
- 系统显示错误：
  ```
  付款申请金额(XXX万元)超过剩余可支付金额(YYY万元)！
  根据规定，支付进度款金额不得突破已完工部分对应的批复概算。
  当前已完工进度：ZZ%
  已支付金额：AAA万元
  剩余可支付：BBB万元
  ```
- 系统强制拦截，无法提交
- 系统记录拦截日志（审计用）
- 用例结束

**E2: 未关联进度确认单**
- 在步骤4，如果未关联进度确认单
- 系统显示警告："建议关联进度确认单，确保付款依据充分"
- 用户可以选择继续或返回

**后置条件**：
- POST-01: 付款申请记录已创建
- POST-02: 付款工作流实例已创建
- POST-03: 审批任务已分配
- POST-04: 超额检查日志已记录

**业务规则**：
- BR-020: 付款申请金额不得超过"合同总金额 × 已完工进度比例 - 已支付金额"
- BR-021: 已完成工程量的核算须经发承包双方共同确认
- BR-022: 超额支付必须强制拦截，无例外

---

#### 4.2.2 用例：自动化提醒与预警系统 ⭐

**用例ID**：UC-07  
**用例名称**：自动化提醒与预警系统  
**主要参与者**：系统（定时任务）、相关业务人员  
**优先级**：P1 - 应该实现（业务价值高）

**说明**：  
本用例描述系统的自动化通知机制，通过时间触发和事件触发两种方式，确保关键业务节点不被遗漏。

**功能模块1：时间触发提醒**

| 提醒类型 | 触发条件 | 通知对象 | 通知方式 | 优先级 |
|---------|---------|---------|---------|-------|
| 付款到期提醒 | 付款日期前3天 | 项目经办、财务 | 站内信+邮件 | P0 |
| 合同到期提醒 | 合同结束日期前7天 | 项目经办、审批领导 | 站内信+邮件 | P1 |
| 审批超时催办 | 审批任务停留48小时 | 审批人、其上级 | 站内信+邮件 | P0 |
| 进度确认提醒 | 里程碑日期前5天 | 项目经办 | 站内信 | P1 |

**实现方式**：
- 使用Spring Scheduled定时任务
- 每天上午9:00执行检查（cron: 0 0 9 * * ?）
- 每小时检查审批超时情况

**功能模块2：事件触发提醒**

| 事件类型 | 触发条件 | 通知对象 | 通知内容 | 优先级 |
|---------|---------|---------|---------|-------|
| 审批任务分配 | 新审批任务创建 | 审批人 | "您有新的合同待审批：XXX" | P0 |
| 审批通过 | 审批流程完成 | 合同创建人 | "合同XXX已审批通过" | P0 |
| 审批驳回 | 任意节点驳回 | 合同创建人 | "合同XXX已被驳回，原因：..." | P0 |
| 超额预警 | 付款申请超额 | 财务主管、分管领导 | "付款申请超额，已拦截" | P0 |
| 逾期预警 | 付款/进度逾期 | 项目经办、部门领导 | "合同XXX付款已逾期X天" | P1 |
| 高风险合同 | AI审查发现高风险 | 法务主管、分管领导 | "发现高风险合同，请重点关注" | P1 |

**详细流程（以审批超时催办为例）**：

1. 定时任务每小时执行一次
2. 查询数据库：所有状态为"待审批"且创建时间>48小时的任务
3. 对于每个超时任务：
   - 查询审批人信息
   - 构建催办消息："您有审批任务已停留48小时，请及时处理"
   - 发送站内消息
   - 发送邮件
   - 如果审批人为科长/处长，同时通知其上级
4. 记录催办日志
5. 在Dashboard上高亮显示超时任务

**后置条件**：
- POST-01: 相关人员收到通知
- POST-02: 提醒/催办日志已记录
- POST-03: Dashboard状态已更新

**业务规则**：
- BR-050: 同一事件不重复通知（24小时内）
- BR-051: 高优先级通知失败时，应重试3次
- BR-052: 邮件发送失败不阻断业务流程

---

#### 4.2.3 用例：履约保证金管理

**用例ID**：UC-08  
**用例名称**：履约保证金管理  
**主要参与者**：项目经办人员、财务人员  
**优先级**：P0 - 必须实现

**前置条件**：
- PRE-01: 合同已审批通过
- PRE-02: 已明确中标价

**基本流程**：

1. 合同创建时，系统自动计算履约保证金：
   ```
   履约保证金 = 中标价 × 10%
   ```
2. 合同审批通过后，系统生成"保证金缴纳提醒"
3. 财务人员收到缴纳金额确认
4. 财务人员在系统中记录保证金缴纳信息：
   - 缴纳金额
   - 缴纳日期
   - 缴纳凭证（上传附件）
5. 系统验证：缴纳金额必须等于计算的保证金金额
6. 合同执行完毕后，系统生成"保证金退还提醒"
7. 财务人员记录保证金退还信息
8. 系统更新保证金状态为"已退还"

**业务规则**：
- BR-025: 履约保证金必须精确为中标价的10%
- BR-026: 保证金未缴纳前，不允许申请第一笔付款
- BR-027: 合同完全履行后，保证金应在30天内退还

---

### 4.3 智能增强功能

#### 4.3.1 用例：高级搜索与过滤

**用例ID**：UC-10  
**用例名称**：高级搜索与过滤  
**主要参与者**：所有用户  
**优先级**：P1 - 应该实现

**基础搜索功能**（P0）：
- 按合同编号精确搜索
- 按合同名称模糊搜索
- 按状态筛选（草稿/审批中/已通过/已驳回）
- 按金额区间筛选
- 按时间范围筛选（签订日期、创建日期）
- 按创建人筛选

**高级搜索功能**（P1）：
- 多条件组合搜索（AND/OR逻辑）
- 按甲方/乙方搜索
- 按审批人搜索
- 保存搜索条件为"常用筛选"

**全文检索**（P2，可选）：
- 使用Elasticsearch实现
- 支持合同正文内容搜索
- 支持审批意见搜索
- 搜索结果高亮显示

---

#### 4.3.2 用例：AI语义搜索（高级功能）⭐

**用例ID**：UC-12  
**用例名称**：AI语义搜索  
**主要参与者**：所有用户  
**优先级**：P2 - 可以实现（创新亮点，难度较高）

**前置条件**：
- PRE-01: 已集成向量数据库（Chroma/Milvus）或LLM Embedding API
- PRE-02: 合同数据已向量化索引

**基本流程**：

1. 用户在搜索框输入自然语言查询：
   - 例如："查找所有关于延期罚款的合同"
   - 例如："找出付款条件对我方不利的合同"
2. 系统调用LLM API，将查询转换为向量
3. 系统在向量数据库中进行相似度搜索
4. 系统返回语义相关的合同列表
5. 系统高亮显示匹配的条款片段
6. 用户点击查看合同详情

**技术实现要点**：
- 使用OpenAI Embedding API或开源模型（如BGE）
- 向量维度：1536维或768维
- 相似度计算：余弦相似度
- Top-K检索：返回相似度最高的10个结果

**降级方案**（如果向量数据库复杂度过高）：
- 使用LLM API进行语义理解
- 将自然语言查询转换为SQL查询
- 使用传统全文检索

**评估标准**：
- 搜索准确率≥60%即可认为达标
- 响应时间≤5秒

---

#### 4.3.3 用例：数据可视化Dashboard

**用例ID**：UC-13  
**用例名称**：数据可视化Dashboard  
**主要参与者**：管理层、项目经办、财务  
**优先级**：P1 - 应该实现

**功能模块**：

**1. 合同概览（P0）**
- 合同总数统计（按状态分类）
- 合同总金额统计
- 本月新增合同数量
- 待审批合同数量（红色警示）

**2. 审批效率分析（P1）**
- 平均审批时长（天）
- 审批通过率
- 各审批节点平均停留时间
- 审批人工作量排行

**3. 付款监控（P0）**
- 待付款总金额
- 本月已付款金额
- 逾期付款数量（红色警示）
- 付款计划执行率

**4. 风险监控（P1）**
- 高风险合同数量
- 逾期合同数量
- 超额预警次数
- 风险分布（饼图）

**5. 金额分布分析（P1）**
- 合同金额分布（柱状图）
- 各部门合同金额占比（饼图）
- 月度合同签订趋势（折线图）

**技术实现**：
- 前端使用ECharts图表库
- 后端提供聚合统计API
- 支持日期范围筛选
- 支持导出为PDF/Excel

---

### 4.4 支撑功能

#### 4.4.1 用例：用户登录与权限管理

**用例ID**：UC-09  
**功能需求ID**：FR-030 ~ FR-035  
**优先级**：P0 - 必须实现

**核心需求**：
- FR-030: 系统应提供用户名密码登录功能
- FR-031: 系统应使用JWT实现无状态认证
- FR-032: 系统应实现RBAC权限模型
- FR-033: 系统应支持5种角色：项目经办、法务、财务、审批领导、系统管理员
- FR-034: 系统应根据用户角色控制菜单和功能访问
- FR-035: 密码必须使用BCrypt加密存储

#### 4.4.2 组织架构管理

**功能需求ID**：FR-036 ~ FR-038  
**优先级**：P0 - 必须实现

**核心需求**：
- FR-036: 系统应支持部门树形结构管理（最多3级）
- FR-037: 系统应支持为用户指定直属上级（用于审批路由）
- FR-038: 系统应支持用户跨部门兼职

#### 4.4.3 文件管理

**功能需求ID**：FR-039 ~ FR-042  
**优先级**：P0 - 必须实现

**核心需求**：
- FR-039: 系统应支持上传PDF、Word、图片格式文件
- FR-040: 单个文件大小限制为50MB
- FR-041: 系统应使用对象存储（MinIO/OSS）存储文件
- FR-042: 文件下载链接应包含时效性Token（有效期1小时）

#### 4.4.4 协作与评论功能

**功能需求ID**：FR-043 ~ FR-045  
**优先级**：P2 - 可以实现（提升协作效率）

**核心需求**：
- FR-043: 系统应支持在合同详情页添加评论
- FR-044: 系统应支持@提醒相关人员
- FR-045: 被@的用户应收到通知

---

## 5. 外部接口需求

### 5.1 用户界面需求

**UI-001**: 系统应采用响应式设计，支持1366×768及以上分辨率  
**UI-002**: 系统应使用Element Plus组件库，保持UI一致性  
**UI-003**: 关键操作（删除、驳回）应有二次确认对话框  
**UI-004**: 表单验证错误应实时提示，并高亮错误字段  
**UI-005**: 系统应提供面包屑导航和页面标题，明确用户当前位置

### 5.2 软件接口

**SI-001: LLM API接口**
- **接口名称**：文心一言API / 通义千问API
- **用途**：AI合同生成、AI风险审查
- **协议**：HTTPS
- **超时时间**：30秒
- **降级策略**：超时或失败时，返回默认提示，不阻断业务流程

**SI-002: 对象存储接口**
- **接口名称**：MinIO API / 阿里云OSS API
- **用途**：合同文件、附件存储
- **协议**：HTTPS
- **认证方式**：AccessKey + SecretKey

**SI-003: 邮件服务接口**
- **接口名称**：SMTP协议
- **用途**：发送审批通知、提醒邮件
- **服务器**：企业邮箱SMTP服务器
- **端口**：465 (SSL)

### 5.3 通信接口

**CI-001**: 前后端通信应使用RESTful API  
**CI-002**: 数据格式应使用JSON  
**CI-003**: 所有HTTP通信必须使用HTTPS (TLS 1.2+)  
**CI-004**: API响应格式统一：
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1700000000000
}
```

---

## 6. 非功能需求

### 6.1 性能需求

| 需求ID | 需求描述 | 指标 | 测试方法 |
|-------|---------|------|---------|
| NFR-001 | 用户登录响应时间 | ≤ 1秒 | 并发100用户登录测试 |
| NFR-002 | 合同列表查询响应时间 | ≤ 2秒 | 分页查询100条记录 |
| NFR-003 | 合同创建响应时间 | ≤ 2秒 | 不含文件上传 |
| NFR-004 | AI合同生成时间 | ≤ 30秒 | 超时则降级 |
| NFR-005 | AI风险审查时间 | ≤ 30秒 | 超时则降级 |
| NFR-006 | 系统并发用户数 | 支持100并发 | JMeter压力测试 |
| NFR-007 | 数据库查询优化 | 慢查询<100ms | 使用索引优化 |

### 6.2 安全性需求

**身份认证**：
- NFR-010: 系统必须要求用户登录后才能访问业务功能
- NFR-011: 密码必须使用BCrypt加密存储，强度≥10
- NFR-012: 登录失败5次后，账号锁定30分钟
- NFR-013: 会话超时时间为2小时

**权限控制**：
- NFR-014: 系统必须实现RBAC权限模型
- NFR-015: 用户只能查看和编辑自己创建的草稿合同
- NFR-016: 审批人只能审批分配给自己的任务
- NFR-017: 系统管理员不得直接访问业务数据

**数据安全**：
- NFR-018: 所有HTTP通信必须使用HTTPS (TLS 1.2+)
- NFR-019: 敏感字段（金额、当事人）在日志中应脱敏
- NFR-020: 操作日志必须不可篡改、不可删除

### 6.3 可靠性需求

- NFR-021: 系统可用性应达到99%（允许每月停机7.2小时）
- NFR-022: 数据库应每日自动备份，保留最近30天
- NFR-023: 关键业务操作应使用数据库事务保证一致性
- NFR-024: 外部API调用失败时，应有降级策略

### 6.4 可维护性需求

- NFR-025: 代码注释覆盖率应≥30%
- NFR-026: 核心业务逻辑应有单元测试，覆盖率≥60%
- NFR-027: 系统应提供完整的API文档（Swagger）
- NFR-028: 系统配置应外部化，不得硬编码

### 6.5 可用性需求

- NFR-029: 错误提示信息应清晰易懂，告诉用户如何解决
- NFR-030: 系统应支持Chrome 90+、Edge 90+、Firefox 88+
- NFR-031: 关键操作应有操作指引或帮助提示
- NFR-032: 系统响应时间超过3秒应显示加载动画

---

## 7. 数据需求

### 7.1 数据实体

**核心实体及属性**：

1. **合同 (Contract)**
   - 合同ID、合同编号、合同名称、合同类型
   - 甲方、乙方、中标价、合同金额、履约保证金
   - 签订日期、开始日期、结束日期
   - 合同正文、文件URL、状态
   - 创建人、创建时间、更新时间

2. **工作流实例 (WorkflowInstance)**
   - 实例ID、业务类型、业务ID
   - 工作流定义ID、当前节点、状态
   - 开始时间、结束时间

3. **审批任务 (ApprovalTask)**
   - 任务ID、实例ID、节点名称
   - 审批人ID、审批状态、审批意见
   - 创建时间、完成时间

4. **付款计划 (PaymentPlan)**
   - 计划ID、合同ID、里程碑
   - 计划金额、计划日期
   - 实际金额、实际日期、状态

5. **用户 (User)**
   - 用户ID、用户名、密码（加密）
   - 真实姓名、邮箱、手机号
   - 部门ID、状态

### 7.2 数据完整性约束

| 约束类型 | 约束描述 |
|---------|---------|
| 实体完整性 | 所有表必须有主键 |
| 参照完整性 | 外键关联必须有效，删除时级联处理 |
| 域完整性 | 合同金额、保证金必须≥0；状态必须为枚举值 |
| 用户自定义 | 合同金额必须等于中标价；保证金必须等于中标价×10% |

### 7.3 数据量预估

| 数据类型 | 年增长量 | 5年总量 |
|---------|---------|---------|
| 合同记录 | 2,000条 | 10,000条 |
| 用户记录 | 200个 | 1,000个 |
| 工作流实例 | 4,000个 | 20,000个 |
| 审批任务 | 12,000个 | 60,000个 |
| 文件存储 | 100GB | 500GB |

---

## 8. 需求追踪矩阵

### 8.1 需求与用例的追踪

| 需求ID | 需求描述 | 用例ID | 用例名称 | 优先级 |
|-------|---------|--------|---------|-------|
| FR-001 | 系统应支持四级审批流程 | UC-02, UC-03 | 提交审批、审批合同 | P0 |
| FR-002 | 系统应根据金额自动路由审批路径 | UC-02, UC-11 | 提交审批、动态审批配置 | P0/P2 |
| FR-003 | 系统应在付款申请时校验并拦截超额 | UC-06 | 申请进度款 | P0 |
| FR-004 | 系统应自动计算履约保证金 | UC-01, UC-08 | 创建合同、保证金管理 | P0 |
| FR-005 | 系统应提供AI对话式合同生成功能 | UC-04 | AI对话式生成 | P1 |
| FR-006 | 系统应提供AI风险审查功能 | UC-05 | AI风险审查 | P1 |
| FR-007 | 系统应提供自动化提醒功能 | UC-07 | 自动化提醒与预警 | P1 |
| FR-008 | 系统应支持高级搜索与过滤 | UC-10 | 高级搜索 | P1 |
| FR-009 | 系统应提供AI语义搜索功能 | UC-12 | AI语义搜索 | P2 |
| FR-010 | 系统应提供数据可视化Dashboard | UC-13 | Dashboard | P1 |
| FR-030-035 | 系统应提供用户认证与权限管理 | UC-09 | 用户登录与权限管理 | P0 |

### 8.2 功能需求完整列表（按优先级）

**P0级需求（必须实现）- 共20个**：

| 需求ID | 需求描述 | 对应题目要求 |
|-------|---------|-------------|
| FR-001 | 系统应支持四级审批流程 | 分级审批程序 |
| FR-002 | 系统应根据金额自动路由审批路径（基础实现） | 按变更金额分级 |
| FR-003 | 系统应在付款申请时校验并强制拦截超额 | 不得突破批复概算 |
| FR-004 | 系统应自动计算履约保证金（中标价10%） | 履约保证金制度 |
| FR-010 | 系统应支持合同的创建、查看、编辑、删除 | 基础功能 |
| FR-011 | 合同金额必须与中标价一致（强制校验） | 合同价须与中标价一致 |
| FR-012 | 系统应支持合同文件上传和存储 | 集中数据存储 |
| FR-013 | 系统应记录合同的所有操作日志 | 不可篡改的审计跟踪 |
| FR-014 | 系统应支持工程进度确认 | 发承包双方共同确认 |
| FR-015 | 系统应支持付款计划管理 | 进度款支付监控 |
| FR-020 | 系统应支持审批任务的创建和分配 | 工作流自动化 |
| FR-021 | 审批人应能通过、驳回、转办审批任务 | 审批操作 |
| FR-022 | 系统应在审批任务分配时发送通知 | 自动化 |
| FR-030 | 系统应提供用户登录功能 | 基础功能 |
| FR-031 | 系统应使用JWT实现认证 | 技术要求 |
| FR-032 | 系统应实现RBAC权限模型 | 安全性 |
| FR-036 | 系统应支持部门组织架构管理 | 审批流路由基础 |
| FR-039 | 系统应支持文件上传和下载 | 集中数据存储 |

**P1级需求（应该实现）- 共15个**：

| 需求ID | 需求描述 | 亮点特性 |
|-------|---------|---------|
| FR-005 | 系统应提供AI对话式合同生成功能 | ⭐ AI应用亮点 |
| FR-006 | 系统应提供AI合同风险审查功能 | ⭐ AI应用亮点 |
| FR-007 | 系统应提供自动化时间触发提醒 | 自动化 |
| FR-008 | 系统应提供自动化事件触发提醒 | 自动化 |
| FR-016 | 系统应在付款逾期时自动预警 | 合规性监控 |
| FR-017 | 系统应在审批超时时自动催办 | 效率提升 |
| FR-023 | 系统应支持合同版本控制 | 质量保证 |
| FR-024 | 系统应支持合同变更管理 | 完整生命周期 |
| FR-025 | 系统应提供高级搜索功能 | 高级搜索 |
| FR-026 | 系统应提供数据Dashboard | 数据可视化 |
| FR-027 | 系统应支持审批效率统计分析 | 数据洞察 |
| FR-028 | 系统应支持风险合同监控面板 | 风险管理 |

**P2级需求（可以实现）- 共8个**：

| 需求ID | 需求描述 | 说明 |
|-------|---------|------|
| FR-009 | 系统应提供AI语义搜索功能 | ⭐ 高级AI功能，需向量数据库 |
| FR-018 | 系统应支持可视化工作流设计器 | 技术难度极高，建议降级 |
| FR-019 | 系统应支持全文检索（Elasticsearch） | 需额外技术栈 |
| FR-029 | 系统应支持合同模板管理 | 增强功能 |
| FR-043 | 系统应支持评论与@功能 | 协作工具 |
| FR-044 | 系统应支持合同对比功能 | 辅助功能 |
| FR-045 | 系统应支持数据导出（Excel/PDF） | 辅助功能 |

### 8.3 需求与测试的追踪

| 需求ID | 测试用例ID | 测试类型 | 预期结果 |
|-------|-----------|---------|---------|
| FR-002 | TC-001 | 功能测试 | 金额<5万，路由到2级审批 |
| FR-002 | TC-002 | 功能测试 | 金额≥50万，路由到4级审批 |
| FR-002 | TC-003 | 边界测试 | 金额=5万，路由到3级审批 |
| FR-003 | TC-010 | 功能测试 | 申请金额超额，系统拦截并提示 |
| FR-003 | TC-011 | 边界测试 | 申请金额等于剩余额度，通过 |
| FR-003 | TC-012 | 边界测试 | 申请金额超出0.01元，拦截 |
| FR-004 | TC-020 | 功能测试 | 履约保证金自动计算为中标价10% |
| FR-004 | TC-021 | 边界测试 | 中标价100万，保证金=10万 |
| FR-005 | TC-030 | 功能测试 | AI对话生成合同，内容完整 |
| FR-005 | TC-031 | 异常测试 | AI服务失败，自动降级到表单模式 |
| FR-006 | TC-040 | 功能测试 | AI识别出高风险条款 |
| FR-006 | TC-041 | 异常测试 | AI服务超时，生成默认报告不阻断流程 |
| FR-007 | TC-050 | 功能测试 | 付款日期前3天发送提醒 |
| FR-007 | TC-051 | 功能测试 | 审批任务超时48小时发送催办 |
| FR-011 | TC-060 | 功能测试 | 合同金额≠中标价，提交时拦截 |
| NFR-001 | TC-100 | 性能测试 | 登录响应时间<1秒（100并发） |
| NFR-002 | TC-101 | 性能测试 | 合同列表查询<2秒 |
| NFR-004 | TC-102 | 性能测试 | AI生成超时30秒，自动降级 |

---

## 9. 附录

### 9.1 用例总览

本系统共包含13个核心用例，覆盖合同全生命周期管理：

| 模块 | 用例ID | 用例名称 | 优先级 | 技术亮点 |
|------|--------|---------|-------|---------|
| **合同生命周期** | UC-01 | 创建合同（基础表单） | P0 | - |
| | UC-02 | 提交合同审批 | P0 | ⭐ 动态审批路由 |
| | UC-03 | 审批合同 | P0 | - |
| | UC-04 | AI对话式合同生成 | P1 | ⭐⭐⭐ AI多轮对话 |
| | UC-05 | AI合同风险审查 | P1 | ⭐⭐⭐ AI风险识别 |
| | UC-11 | 动态审批流程配置 | P2 | 配置化工作流 |
| **进度款监控** | UC-06 | 申请进度款 | P0 | ⭐ 超额预警拦截 |
| | UC-07 | 自动化提醒与预警 | P1 | 时间+事件触发 |
| | UC-08 | 履约保证金管理 | P0 | 自动计算10% |
| **智能增强** | UC-10 | 高级搜索与过滤 | P1 | 多条件组合 |
| | UC-12 | AI语义搜索 | P2 | ⭐⭐⭐ 向量检索 |
| | UC-13 | 数据可视化Dashboard | P1 | ECharts图表 |
| **支撑功能** | UC-09 | 用户登录与权限管理 | P0 | RBAC模型 |

**系统三大技术亮点**：
1. **AI对话式合同生成（UC-04）**：多轮对话交互，自然语言理解，自动提取结构化信息
2. **AI合同风险审查（UC-05）**：自动识别风险条款，生成审查报告，辅助决策
3. **超额预警拦截机制（UC-06）**：强制校验付款金额，确保资金安全

### 9.2 UML建模图说明

**附录A：系统用例图**  
（建议使用Visual Paradigm或Draw.io绘制）

用例图应包含：
- **参与者**：
  - 主要参与者：项目经办、法务、财务、审批领导、系统管理员
  - 次要参与者：LLM API、对象存储服务、邮件服务
- **用例分组**：
  - 合同管理模块（6个用例）
  - 进度款监控模块（3个用例）
  - 智能增强模块（3个用例）
  - 系统管理模块（1个用例）
- **用例关系**：
  - UC-02 «include» UC-05（提交审批时触发AI审查）
  - UC-04 «extend» UC-01（AI生成是创建合同的扩展方式）

**附录B：合同审批活动图**  
（描述UC-02的完整流程）

活动图应包含：
1. 开始：用户点击"提交审批"
2. 决策节点1：合同信息是否完整？
3. 决策节点2：金额范围判断（4个分支）
4. 并行节点：同时进行AI风险审查（可失败）
5. 活动：创建工作流实例、创建审批任务
6. 活动：发送通知
7. 结束：返回成功提示

**附录C：合同状态图**  
（描述合同的生命周期状态转换）

状态及转换：
- `[草稿]` →（提交审批）→ `[审批中]`
- `[审批中]` →（审批通过）→ `[已通过]`
- `[审批中]` →（审批驳回）→ `[已驳回]`
- `[已驳回]` →（修改后重新提交）→ `[审批中]`
- `[已通过]` →（开始执行）→ `[执行中]`
- `[执行中]` →（完工）→ `[已完成]`

**附录D：审批流程时序图**  
（描述UC-02的关键对象交互）

参与对象：
- Controller（控制器）
- ContractService（合同服务）
- WorkflowRouter（工作流路由器）
- WorkflowEngine（工作流引擎）
- AIRiskReviewService（AI审查服务）
- NotificationService（通知服务）

### 9.3 需求优先级汇总

| 优先级 | 功能需求数量 | 非功能需求数量 | 总计 | 占比 |
|-------|------------|--------------|------|------|
| P0 (Must Have) | 20 | 12 | 32 | 60% |
| P1 (Should Have) | 15 | 6 | 21 | 40% |
| P2 (Could Have) | 8 | 0 | 8 | 15% |
| **总计** | **43** | **18** | **61** | - |

**开发策略建议**：
- **第一阶段（6周）**：完成所有P0需求，确保核心功能可用
- **第二阶段（4周）**：实现P1需求中的AI功能和自动化提醒
- **第三阶段（2周）**：根据时间情况，选择性实现P2需求

### 9.4 与题目要求的对应关系

| 题目要求 | 对应功能 | 实现方式 | 优先级 |
|---------|---------|---------|-------|
| **合同内容规范生成** | UC-01/UC-04/UC-05 | 表单+AI生成+AI审查 | P0/P1 |
| 分级审批程序 | UC-02/UC-03 | 动态审批路由 | P0 |
| 按金额分级（4个级别） | UC-02 | 金额区间匹配审批路径 | P0 |
| 履约保证金（10%） | UC-01/UC-08 | 自动计算与管理 | P0 |
| **工程进度款监控** | UC-06/UC-07/UC-08 | 超额预警+自动提醒 | P0/P1 |
| 不得突破批复概算 | UC-06 | 强制校验与拦截 | P0 |
| 发承包双方确认 | UC-06 | 进度确认流程 | P0 |
| AI技术应用 | UC-04/UC-05/UC-12 | LLM API集成 | P1/P2 |
| 集中数据存储 | 第7章 | 数据库+对象存储 | P0 |
| 自动化 | UC-07 | 定时任务+事件触发 | P1 |
| 高级搜索 | UC-10/UC-12 | 多条件+语义搜索 | P1/P2 |
| 审计跟踪 | 第7章 | 操作日志记录 | P0 |
| 合规性监控 | UC-05/UC-07 | AI审查+预警 | P1 |
| 风险管理 | UC-05/UC-13 | AI识别+Dashboard | P1 |
| 协作工具 | 4.4.4 | 评论与@功能 | P2 |

**覆盖度**：题目列出的15项功能要求，本SRS全部覆盖，其中12项为P0/P1优先级。

### 9.5 系统创新点总结

**1. 深度AI应用**（体现AI技术要求）
- ✨ **对话式合同生成**：突破传统表单填写，通过多轮对话自然交互
- ✨ **智能风险审查**：自动识别不合规条款，生成详细审查报告
- ✨ **语义搜索**（可选）：理解自然语言查询意图，精准检索相关合同

**2. 动态工作流引擎**（体现技术深度）
- ✨ **规则驱动**：根据业务规则自动匹配审批路径
- ✨ **灵活可配**：支持配置化定义工作流，无需修改代码
- ✨ **降级实现**：基础版硬编码 → 进阶版配置化 → 高级版可视化

**3. 全方位监控预警**（体现业务价值）
- ✨ **超额强制拦截**：付款申请超额时，强制中断并告警
- ✨ **智能提醒**：时间触发+事件触发，确保关键节点不遗漏
- ✨ **数据驾驶舱**：可视化展示合同、付款、风险数据

**4. 软件工程最佳实践**（体现课程学习）
- ✨ **系统化需求分析**：文档分析法、用例驱动法、涉众分析
- ✨ **完整追踪体系**：需求→用例→设计→测试的双向追踪
- ✨ **分层架构设计**：基础设施层、核心业务层、智能增强层
- ✨ **降级容错机制**：AI服务失败不阻断核心业务流程

### 9.6 开发可行性评估

| 功能模块 | 难度等级 | 开发时间（人周） | 风险评估 | 应对策略 |
|---------|---------|----------------|---------|---------|
| 基础CRUD | ⭐ 低 | 2周 | 低 | 标准实现 |
| 动态审批流（基础版） | ⭐⭐ 中 | 3周 | 中 | 先硬编码，再配置化 |
| AI对话生成 | ⭐⭐⭐ 中高 | 2周 | 中 | 使用成熟LLM API |
| AI风险审查 | ⭐⭐⭐ 中高 | 2周 | 中 | 降级机制保障 |
| 超额预警拦截 | ⭐⭐ 中 | 1周 | 低 | 业务逻辑清晰 |
| 自动化提醒 | ⭐⭐ 中 | 2周 | 低 | Spring Scheduled |
| Dashboard | ⭐⭐ 中 | 2周 | 低 | ECharts现成方案 |
| AI语义搜索 | ⭐⭐⭐⭐ 高 | 3周 | 高 | 可降级为传统搜索 |
| 可视化工作流设计器 | ⭐⭐⭐⭐⭐ 极高 | 6周+ | 极高 | **建议不实现** |

**总体评估**：
- **P0需求**：可在6-8周内完成，技术风险可控
- **P1需求**：可在10-12周内完成，AI功能有降级方案
- **P2需求**：根据时间选择性实现，AI语义搜索可降级

**关键成功因素**：
1. ✅ 优先保证P0需求完成，确保核心业务可用
2. ✅ AI功能设计降级方案，失败不阻断流程
3. ✅ 动态工作流采用配置化而非可视化实现
4. ✅ 团队分工明确，前后端并行开发

### 9.7 涉众联系方式

| 涉众角色 | 姓名 | 联系方式 | 备注 |
|---------|------|---------|------|
| 课程指导教师 | XXX教授 | xxx@university.edu | 需求最终审批人 |
| 项目经理 | XXX | xxx@team.com | 项目总协调 |
| 需求分析师 | XXX | xxx@team.com | SRS文档负责人 |
| 开发负责人 | XXX | xxx@team.com | 技术决策 |

---

## 文档总结

本软件需求规格说明书（SRS）全面、系统地定义了智慧合同管理系统的需求，具有以下特点：

### ✅ 需求完整性
- 覆盖题目要求的两大核心场景：合同内容规范生成 + 工程进度款监控
- 包含43个功能需求、18个非功能需求，共61个需求
- 详细描述13个核心用例，涵盖合同全生命周期

### ✅ 方法论体现
- **需求获取**：文档分析法、用例驱动法、场景分析法
- **涉众管理**：识别5类涉众，分析利益冲突并提出平衡策略
- **需求管理**：MoSCoW优先级划分，需求追踪矩阵
- **质量保证**：完整的前置/后置条件、扩展流程、业务规则

### ✅ 技术深度
- **AI深度应用**：对话式生成、智能风险审查、语义搜索
- **动态工作流**：规则驱动的审批路由，配置化实现
- **自动化监控**：时间+事件双触发器，全方位预警

### ✅ 可实现性
- P0需求基于成熟技术栈，6-8周可完成
- P1需求有明确实现方案，10-12周可完成
- P2需求标注为可选，有降级方案
- 所有AI功能设计了降级机制，确保业务连续性

### 📊 关键数据
- **用例数量**：13个核心用例
- **功能需求**：43个（P0:20个，P1:15个，P2:8个）
- **非功能需求**：18个（性能、安全、可靠性等）
- **测试用例**：18个（覆盖核心需求）
- **文档规模**：约1500行，15,000字

### 🎯 核心亮点
1. **AI对话式合同生成**：多轮对话，自然交互
2. **AI合同风险审查**：自动识别风险，辅助决策
3. **超额预警拦截**：强制校验，确保资金安全
4. **动态审批路由**：规则驱动，灵活配置

---

**文档批准**

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 项目经理 | | | |
| 需求分析师 | | | |
| 指导教师 | | | |

---

**版本控制**

本文档采用Git进行版本控制，文档路径：`/SRS-智慧合同管理系统-需求规格说明书.md`

**后续工作**

基于本SRS文档，后续工作包括：
1. 绘制完整的UML图（用例图、活动图、状态图、时序图）
2. 编写软件设计说明书（SDS）
3. 中期答辩准备（重点讲解需求获取方法和核心用例）
4. 开始系统开发（按P0→P1→P2顺序迭代）

---

**文档结束**

本SRS文档已完成需求分析和内部评审，将作为后续设计、开发、测试和验收的基准文档。如需变更需求，需按照变更管理流程提交变更请求（Change Request），经过影响分析和评审后更新文档版本。

📧 如有疑问，请联系需求分析师：xxx@team.com  
📅 文档最后更新时间：2025年11月19日  
📌 文档状态：**正式发布**

