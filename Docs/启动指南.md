# 电信智慧合同管理系统 - 启动指南

## ⚡ 一键启动脚本（推荐）

项目提供了跨平台的一键启动脚本，自动检查环境并启动服务，带有进度提示和图标显示。

### Windows 用户

**方式一：双击运行（推荐）**
```
双击项目根目录下的 start.bat 文件
```

**方式二：PowerShell运行**
```powershell
# 在项目根目录打开 PowerShell
.\start.ps1

# 如果提示脚本执行策略问题，使用以下命令
powershell -ExecutionPolicy Bypass -File .\start.ps1
```

### Linux / Mac 用户

```bash
# 添加执行权限（首次使用）
chmod +x start.sh

# 运行启动脚本
./start.sh
```

### 启动脚本功能

脚本运行后会显示交互式菜单：

```
  ╔══════════════════════════════════════════════════════════╗
  ║       电信智慧合同管理系统                               ║
  ║       Telecom Intelligent Contract System                ║
  ╚══════════════════════════════════════════════════════════╝

🔍 正在检查运行环境...

  [1/4] 检查 Node.js... ✓ 已安装 (v20.19.0)
  [2/4] 检查 npm... ✓ 已安装 (v10.8.0)
  [3/4] 检查 Java... ✓ 已安装
  [4/4] 检查 Maven... ✓ 已安装

✅ 环境检查通过!

🚀 请选择启动模式:

  [1] 启动全部 (后端 + 前端)
  [2] 仅启动后端
  [3] 仅启动前端
  [4] 安装依赖 (首次使用)
  [0] 退出
```

**首次使用时：** 请先选择 `[4] 安装依赖`，然后再选择 `[1] 启动全部`

### 启动成功后的访问地址

| 服务 | 地址 | 说明 |
|------|------|------|
| 前端页面 | http://localhost:5173 | Vue 3 应用 |
| 后端API | http://localhost:8080 | Spring Boot |
| API文档 | http://localhost:8080/doc.html | Knife4j/Swagger |

---

## 📋 环境要求

在启动项目之前，请确保已安装以下软件：

| 软件 | 版本要求 | 说明 |
|------|---------|------|
| JDK | 17+ (推荐21) | 后端使用Java 21 |
| Maven | 3.6+ | Java项目构建工具 |
| Node.js | 20.19+ 或 22.12+ | 前端运行环境 |
| MySQL | 8.0+ | 数据库 |
| Git | 最新版 | 代码版本控制（可选） |

---

## 🗄️ 数据库准备

## 🌐 使用“服务器上的数据库”（你已部署到服务器时）

如果你的 MySQL 不在本机，而是在服务器（例如：`118.31.77.102`），你需要做两件事：

- **确保服务器 MySQL 允许远程连接**：开放 `3306` 端口、防火墙/安全组放行、并给用户授权远程访问（例如 root 仅本机可用时需要单独创建远程用户）。
- **在后端配置数据库连接信息**：本项目已改成**支持环境变量覆盖**（不写死，push 到 Git 后他人也可配置自己的 DB）。

### 方式A：推荐（通过环境变量配置，不改代码）

在启动后端前，在终端里设置环境变量：

**Windows PowerShell：**

```powershell
$env:DB_HOST="118.31.77.102"
$env:DB_PORT="3306"
$env:DB_NAME="contract_system"
$env:DB_USER="root"
$env:DB_PASSWORD="123456"
```

**Linux / Mac：**

```bash
export DB_HOST="118.31.77.102"
export DB_PORT="3306"
export DB_NAME="contract_system"
export DB_USER="root"
export DB_PASSWORD="123456"
```

然后再启动后端（`mvn spring-boot:run` 或 `mvnw spring-boot:run`）。

### 方式B：不推荐（直接改配置文件）

你也可以直接修改 `backend/src/main/resources/application.properties` 里的默认值，但这不利于协作（容易把密码提交到 Git）。

### 1. 创建数据库并导入表结构

项目已提供数据库初始化脚本，按以下步骤操作：

**方式一：使用命令行（推荐）**

```bash
# Windows PowerShell
mysql -u root -p < database\init.sql

# Linux/Mac
mysql -u root -p < database/init.sql
```

**方式二：使用MySQL客户端工具**

1. 打开MySQL Workbench或Navicat等工具
2. 连接到MySQL服务器
3. 依次执行以下SQL文件（按顺序）：
   - `database/init.sql` - 基础表结构
   - `database/rbac_schema.sql` - RBAC权限相关表（如果有）
   - `database/init_data.sql` - 初始数据（如果有）

**方式三：手动执行SQL**

```sql
-- 登录MySQL
mysql -u root -p

-- 执行初始化脚本
source database/init.sql;
```

### 2. 验证数据库

```sql
-- 检查数据库是否创建成功
SHOW DATABASES;

-- 使用数据库
USE contract_system;

-- 检查表是否创建成功
SHOW TABLES;
```

### 3. 修改数据库配置

编辑 `backend/src/main/resources/application.properties`：

```properties
# 修改数据库连接信息
spring.datasource.url=jdbc:mysql://localhost:3306/contract_system?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8
spring.datasource.username=root
spring.datasource.password=你的MySQL密码  # ⚠️ 修改这里
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

---

## 🔧 后端启动

### 方式一：使用Maven命令（推荐）

**前提：确保已安装Maven并配置到PATH环境变量**

```bash
# 1. 进入后端目录
cd backend

# 2. 检查Maven是否安装（可选）
mvn -v

# 3. 编译并启动（首次启动会自动下载依赖，可能需要几分钟）
mvn spring-boot:run

# 或者先编译再运行
mvn clean package
java -jar target/contract-system-0.0.1-SNAPSHOT.jar
```

**注意：** 如果提示找不到`mvn`命令，请：
- Windows: 下载Maven并配置环境变量，或使用IDE内置的Maven
- 使用IDE启动（见方式二）

### 方式二：使用IDE（IntelliJ IDEA / Eclipse）

1. **IntelliJ IDEA**
   - 打开项目根目录
   - 等待Maven自动导入依赖
   - 找到 `ContractSystemApplication.java`
   - 右键 → Run 'ContractSystemApplication'

2. **Eclipse**
   - File → Import → Existing Maven Projects
   - 选择 `backend` 目录
   - 找到 `ContractSystemApplication.java` → Run As → Java Application

### 后端启动成功标志

看到以下日志表示启动成功：

```
Started ContractSystemApplication in X.XXX seconds
```

**后端访问地址：**
- 应用地址：http://localhost:8080
- API文档：http://localhost:8080/doc.html （Knife4j/Swagger）

---

## 🎨 前端启动

### 1. 安装依赖

```bash
# 进入前端目录
cd frontend

# 安装依赖（首次启动需要）
npm install

# 如果npm install很慢，可以使用国内镜像
npm install --registry=https://registry.npmmirror.com
```

### 2. 启动开发服务器

```bash
npm run dev
```

### 3. 前端启动成功标志

看到以下输出表示启动成功：

```
  VITE v7.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

**前端访问地址：** http://localhost:5173

---

## 🚀 完整启动流程

### 第一次启动

```bash
# 1. 克隆项目（如果从Git克隆）
git clone <项目地址>
cd Intelligent-Contract-Management-System

# 2. 创建并配置数据库
# （参考上面的数据库准备步骤）

# 3. 启动后端（新开一个终端窗口）
cd backend
mvn spring-boot:run

# 4. 启动前端（新开另一个终端窗口）
cd frontend
npm install  # 仅首次需要
npm run dev
```

### 日常启动

```bash
# 终端1：启动后端
cd backend
mvn spring-boot:run

# 终端2：启动前端
cd frontend
npm run dev
```

---

## 🔍 验证启动

### 1. 检查后端

访问以下URL验证后端是否正常：

- **健康检查**：http://localhost:8080/actuator/health
- **API文档**：http://localhost:8080/doc.html
- **测试接口**：http://localhost:8080/user/info （需要登录）

### 2. 检查前端

- 打开浏览器访问：http://localhost:5173
- 应该看到登录页面
- 可以尝试登录（使用演示账号或注册新账号）

### 3. 测试登录

根据后端代码，可以使用以下账号测试：

```
用户名: admin
密码: 123456
```

或者注册新账号。

---

## ⚠️ 常见问题

### 问题1：后端启动失败 - 端口被占用

**错误信息：**
```
Port 8080 is already in use
```

**解决方法：**
```bash
# Windows
netstat -ano | findstr :8080
taskkill /PID <进程ID> /F

# Linux/Mac
lsof -i :8080
kill -9 <进程ID>

# 或者修改端口（在application.properties中）
server.port=8081
```

### 问题2：前端启动失败 - 端口被占用

**解决方法：**
```bash
# 修改vite.config.ts中的端口
server: {
  port: 5174  // 改为其他端口
}
```

### 问题3：数据库连接失败

**错误信息：**
```
Communications link failure
```

**解决方法：**
1. 检查MySQL服务是否启动
2. 检查数据库用户名密码是否正确
3. 检查数据库是否已创建
4. 检查防火墙设置

### 问题4：前端npm install失败

**解决方法：**
```bash
# Windows PowerShell
Remove-Item -Recurse -Force node_modules, package-lock.json
npm install

# Linux/Mac
rm -rf node_modules package-lock.json
npm install

# 使用国内镜像（推荐）
npm install --registry=https://registry.npmmirror.com

# 或者使用yarn
yarn install
```

### 问题6：Maven命令不存在

**解决方法：**
1. **下载Maven**：https://maven.apache.org/download.cgi
2. **配置环境变量**：
   - 添加 `MAVEN_HOME` = Maven安装目录
   - 在 `PATH` 中添加 `%MAVEN_HOME%\bin`
3. **或使用IDE内置Maven**：IntelliJ IDEA和Eclipse都内置了Maven

### 问题5：前端无法访问后端接口

**检查项：**
1. 确认后端已启动（http://localhost:8080）
2. 检查 `vite.config.ts` 中的代理配置
3. 检查浏览器控制台是否有CORS错误
4. 确认后端接口路径是否正确

---

## 📝 开发建议

### 后端开发

- 使用IDE的断点调试功能
- 查看日志输出（在 `application.properties` 中配置了debug日志）
- 使用Swagger文档测试接口：http://localhost:8080/doc.html

### 前端开发

- 使用浏览器开发者工具（F12）
- 查看Network面板检查API请求
- 使用Vue DevTools插件调试组件状态

---

## 🛑 停止服务

### 停止后端

在运行后端的终端窗口按 `Ctrl + C`

### 停止前端

在运行前端的终端窗口按 `Ctrl + C`

---

## 📚 相关文档

- [前端文档](./Frontend_Documentation.md) - 前端详细说明和API接口文档
- [SRS文档](./Team_XX_Telecom_Intelligent_Contract_Management_System_SRS.md) - 软件需求规格说明书

---

## 💡 快速命令参考

```bash
# 后端
cd backend
mvn clean package          # 编译打包
mvn spring-boot:run        # 启动
mvn test                   # 运行测试

# 前端
cd frontend
npm install                # 安装依赖
npm run dev                # 开发模式
npm run build              # 生产构建
npm run preview            # 预览构建结果
npm run lint               # 代码检查
```

---

**最后更新：** 2025年12月14日

