# 电信领域智慧合同管理系统 - 软件需求规格说明书 (SRS)

> **文档版本**: v4.0-Lite（组织树版）  
> **编写日期**: 2025年11月  
> **项目名称**: 电信领域智慧合同管理系统  
> **领域专注**: 电信运营商合同管理  
> **设计理念**: **组织树架构 + 树状审批 + 权重控制**

---

## 文档说明

**本版本特点**：
- ✅ **组织树架构**：可视化企业层级，职位节点配置审批权重
- ✅ **成员认证机制**：认证码激活企业身份，安全可控
- ✅ **树状审批**：沿组织树向上审批，避免跨部门混乱
- ✅ **权重控制**：职位权重≥合同金额时自动终审，提升效率
- ✅ **对接人机制**：起草人指定对方对接人，明确责任链条 ⭐
- ✅ **双向审批**：双方各自内部层层审批，任一级驳回即协商 ⭐
- ✅ **双重视角**：公司身份（复杂授权+审批）+ 个人身份（简化流程）
- 🎯 **更符合实际企业管理逻辑**

**与v3.0-Lite对比**：

| 对比项 | v3.0-Lite | v4.0-Lite（本版本）⭐ |
|-------|-----------|---------------------|
| 组织管理 | 平面角色授权 | **组织树结构** ⭐ |
| 成员管理 | 管理员直接授权角色 | **成员认证+自动映射** |
| 审批逻辑 | 金额分级：4级固定路径 | **树状审批+权重控制** ⭐ |
| 审批路径 | 可能跨部门 | **沿部门树向上，不跨部门** |
| 通用性 | 需手动适配不同规模企业 | **自配置树，适应任何规模** ⭐ |
| 个人身份 | 同样需要授权 | **自动拥有权限，无需授权** |

---

## 目录

1. [引言](#1-引言)
2. [综合描述](#2-综合描述)
3. [功能需求](#3-功能需求)
4. [非功能需求](#4-非功能需求)
5. [数据需求](#5-数据需求)
6. [附录](#6-附录)

---

## 1. 引言

### 1.1 编写目的

本软件需求规格说明书（SRS）定义**电信领域智慧合同管理系统（简化版）**的功能需求和约束条件。

**设计目标（v4.0-Lite）**：
- 🎯 **组织树架构**：可视化企业层级，树状审批机制 ⭐⭐⭐
- 🎯 **权重控制**：职位权重动态终审，高效且合理 ⭐⭐⭐
- 🎯 **合同全生命周期**：AI生成、双方协商、签署、变更、归档
- 🎯 **电信领域专业化**：RAG+电信知识库，符合行业规范
- 🎯 **高通用性**：大中小企业+个人业主都适用

### 1.2 项目背景

**领域背景**：  
电信运营商每年签订大量合同，包括基站租赁（60%）、网络建设（25%）、设备采购（10%）、运维服务（5%）。

**核心痛点**：
1. **人工起草效率低**：基站租赁合同人工起草需2小时/份
2. **专业条款易遗漏**：SLA、覆盖率、应急通信等电信条款
3. **双方协商效率低**：线下往返协商，缺乏记录
4. **合规风险高**：电信行业法规约束多
5. **审批流程混乱** ⭐：平面角色授权导致跨部门审批，路径不清晰
6. **企业规模适配难** ⭐：固定分级审批无法适应不同规模企业

**项目目标（v4.0-Lite创新点）**：
- **组织树管理** ⭐⭐⭐：可视化企业层级，灵活配置审批路径
- **树状审批+权重控制** ⭐⭐⭐：沿组织树审批，权重动态终审
- **AI合同生成**：基于RAG+电信知识库，5分钟生成专业合同
- **双方协同**：在线协商、签署、变更，全程可追溯
- **合规保障**：AI审查电信特有条款，识别风险
- **付款提醒**：基于合同约定，自动提醒付款到期

### 1.3 核心术语

| 术语 | 定义 |
|-----|------|
| **RAG** | Retrieval-Augmented Generation，检索增强生成 |
| **本方/对方** ⭐ | 系统采用"本方"与"对方"的相对视角。任何一方使用本系统时，均为"本方"，与其签约的另一方为"对方"。系统不区分"甲方系统"和"乙方系统"，而是统一设计，角色在具体合同中动态确定 |
| **甲方/乙方** | 合同法律角色（非系统角色）。用户在创建合同时，需明确本方在法律上是"甲方"还是"乙方"。例如基站租赁合同中，运营商通常为甲方，业主为乙方。系统记录此信息用于合同展示，但不影响系统功能逻辑 |
| **起草人** ⭐ | 合同的初始创建者（通常为本方员工，如张三）。在合同变更流程中，变更发起人也称为起草人 |
| **对接人** ⭐ | 由起草人指定的对方负责人（如李四）。负责接收合同并在对方组织内发起审批流程 |
| **组织树** | 企业层级结构，从上到下：老板→副总→部门→员工 |
| **职位节点** | 组织树中的节点，包含职位名称和审批权重 |
| **审批权重** | 职位可终审的最大合同金额（如科长20万） |
| **树状审批** | 沿组织树向上审批，权重足够时终止 |
| **双方审批** ⭐ | 合同需经过双方各自内部的树状审批，都通过后才能签署 |
| **成员认证** | 通过认证码激活企业身份 |
| **SLA** | Service Level Agreement，服务等级协议 |

**电信行业术语**：基站、站址、网络覆盖率、开通率、CAPEX/OPEX、应急通信

---

## 2. 综合描述

### 2.1 产品概述

**电信领域智慧合同管理系统（简化版）**是一个专注于**合同全生命周期管理**的系统，通过RAG增强的AI技术和双方协同工作流，实现电信合同的智能化管理。

**核心价值**：
1. **AI生成效率提升95%**：2小时 → 5分钟
2. **双方协同透明化**：在线协商、签署，全程可追溯
3. **电信条款专业化**：内置500+术语、20+模板
4. **合规风险控制**：AI自动识别SLA缺失等风险

### 2.2 系统功能架构

```
┌────────────────────────────────────────────────┐
│           电信领域智慧合同管理系统              │
└────────────────────────────────────────────────┘

【核心层：合同生命周期管理】⭐
├─ 合同起草（支持本方在法律上作为甲方或乙方）
├─ AI合同生成（RAG+电信知识库）
├─ 合同协商（本方与对方多轮协商）
├─ 双方签署（本方签署↔对方签署→生效）
├─ 合同执行（付款计划提醒、履约监控）
├─ 合同变更（变更发起+双向审批+签署）
└─ 合同归档（完工确认+文档归档）

【支撑层：审批与审查】
├─ 树状审批工作流（沿组织树+权重控制）⭐
├─ AI合规审查（电信条款检查）
└─ 法务/财务审核

【AI增强层】⭐ 技术亮点
├─ 电信领域知识库（RAG）
│   ├─ 术语库（500+）
│   ├─ 模板库（20+）
│   ├─ 法规库（10+）
│   └─ 典型条款库（100+）
├─ AI合同生成服务
├─ AI条款审查服务
└─ 向量检索服务（Chroma）

【基础层】
├─ 组织树管理（可视化企业层级）⭐
├─ 成员认证管理（认证码激活身份）⭐
├─ 多身份管理（个人+多公司身份）
├─ 文件存储（MinIO/OSS）
└─ 审计日志
```

### 2.3 核心业务流程（双方协同） ⭐⭐⭐

```
┌─────────────────────────────────────┐
│ 阶段1：起草（本方）                 │
├─────────────────────────────────────┤
│ • 本方起草人（如张三）创建合同      │
│ • 明确本方法律角色（甲方/乙方）     │
│ • AI生成合同（RAG检索知识库）       │
│ • **指定对方对接人（如李四）** ⭐   │
│   - 通过账号/手机号精确指定         │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│ 阶段2：本方内部审批 ⭐              │
├─────────────────────────────────────┤
│ • 系统沿本方组织树向上查找审批路径  │
│ • 审批人依次审批至权重足够职位      │
│ • 若驳回 → 返回本方起草人（张三）   │
│ • 审批通过 → 发送给对方对接人（李四）│
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│ 阶段3：对方审批+协商 ⭐⭐⭐         │
├─────────────────────────────────────┤
│ • 对方对接人（李四）收到合同        │
│ • 李四发起**对方内部审批** ⭐       │
│   - 沿对方组织树向上审批            │
│   - 直到对方有权审批该金额的领导    │
│ • **驳回处理**：                    │
│   - 对方任一级驳回 → 填写意见       │
│   - 流程退回本方起草人（张三）      │
│ • **协商循环**：                    │
│   - 张三修改 → 本方再次审批         │
│   - 通过后 → 李四再次提交对方审批   │
│ • 直到双方所有层级都通过 ⭐         │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│ 阶段4：双方签署 ⭐                  │
├─────────────────────────────────────┤
│ • 前置条件：双方内部审批均全部通过  │
│ • 本方授权人签署                    │
│ • 对方授权人签署                    │
│ • 双方签署完成，合同生效            │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│ 阶段5：执行监控（简化）             │
├─────────────────────────────────────┤
│ • 系统记录付款计划                  │
│ • 到期前15天自动提醒                │
│ • 记录付款执行情况                  │
│ • 逾期自动标记                      │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│ 阶段6：合同变更 ⭐⭐⭐              │
├─────────────────────────────────────┤
│ • 变更起草人（通常为原起草人）发起  │
│ • 本方内部层层审批                  │
│ • 发送给对方对接人（如李四）        │
│ • 对方内部层层审批                  │
│ • 任意一方驳回即进入协商流程        │
│ • 双方终审通过后签署变更协议        │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│ 阶段7：完工归档                     │
├─────────────────────────────────────┤
│ • 双方确认完工                      │
│ • 生成完整档案                      │
│ • 长期存储                          │
└─────────────────────────────────────┘
```

### 2.4 用户特征

| 用户角色 | 主要职责 | 使用频率 |
|---------|---------|---------|
| **组织管理员** ⭐ | 构建组织树、导入成员、配置权重 | 初期高频，后期低频 |
| **公司员工** | 起草合同、协商、审批（按职位权重） | 每日 |
| **公司领导** | 审批大额合同（按职位权重） | 每周 |
| **个人业主** | 起草合同、协商、签署（无需审批） | 每月 |
| **系统管理员** | 维护知识库、配置系统 | 每周 |

### 2.5 设计约束

| 约束类型 | 约束内容 |
|---------|---------|
| **时间约束** | 开发周期13周（3.25个月）⭐ |
| **技术约束** | Vue 3 + Spring Boot 3 + Python FastAPI |
| **成本约束** | LLM API控制在低成本范围 |
| **业务约束** | 合同金额与中标价一致，履约保证金10% |

### 2.6 系统扩展性（简述）

**合同类型扩展**：
- **预置类型**：基站租赁、网络建设、设备采购、运维服务
- **管理员自定义**：可添加新合同类型，配置专有字段
- **RAG动态学习**：上传历史合同，系统自动学习

**覆盖度**：预置4种类型覆盖95%电信合同，剩余5%通过RAG扩展支持。

### 2.7 组织管理机制 ⭐⭐⭐ 核心创新

#### 2.7.1 设计理念

**核心问题**：不同规模组织的审批需求差异巨大
- 大型运营商：需要4级审批（科员→科长→处长→局长）
- 中型公司：2-3级审批（员工→经理→总经理）
- 小公司：1级审批（员工→老板）
- 个人业主：无需审批

**解决方案**：**组织树 + 成员认证 + 权重控制**

#### 2.7.2 组织树结构

**定义**：企业层级的可视化树状结构，每个节点代表一个职位。

**关键属性**：
- **职位名称**：如"总经理"、"网络建设部科长"
- **审批权重**：该职位可终审的最大合同金额（如科长20万元）
- **父子关系**：父节点是上级职位

**示例**：
```
中国移动XX分公司（组织树）
├─ 总经理（权重：无限制）
│   ├─ 副总A（权重：200万）
│   │   └─ 网络建设处长（权重：50万）
│   │       └─ 网建科长A（权重：20万）
│   │           └─ 项目经理（权重：5万）
│   └─ 副总B（权重：200万）
│       └─ 财务处长（权重：30万）
└─ ...
```

**构建方式**：
1. 组织管理员注册公司时构建
2. 可随时调整（添加/删除/修改节点）
3. 支持多分支（不同部门）

#### 2.7.3 成员认证机制

**流程**：
1. **管理员导入成员**：Excel批量导入或手动添加
   - 包含：姓名、手机号、工号、职位名称
2. **系统生成认证码**：6位随机码，短信发送给成员
3. **成员认证**：用户登录系统，输入认证码激活企业身份
4. **认证成功**：用户获得该职位的权限和审批权重

**安全性**：
- 认证码一次性使用
- 手机号必须匹配
- 防止随意授权

#### 2.7.4 树状审批机制 ⭐

**审批路径计算**：
1. 获取起草人的职位节点（如"项目经理"）
2. 沿组织树向上查找：项目经理 → 科长 → 处长 → 副总 → 总经理
3. 检查每个节点的**审批权重**：
   - 如权重 < 合同金额 → 继续向上
   - 如权重 ≥ 合同金额 → **终审人**，停止
4. 生成审批节点列表

**示例**：
- 项目经理起草50万合同：
  - 科长（权重20万）< 50万 → 继续
  - 处长（权重50万）≥ 50万 → 终审 ✓
  - 审批路径：科长 → 处长
  
- 项目经理起草5万合同：
  - 科长（权重20万）≥ 5万 → 终审 ✓
  - 审批路径：科长

**优势**：
- ✅ 审批路径清晰（沿部门树向上）
- ✅ 避免跨部门审批混乱
- ✅ 权重控制减少不必要审批
- ✅ 自动适应任何组织规模

#### 2.7.5 个人身份简化

**设计原则**：个人业主不需要复杂管理

**简化措施**：
- ❌ 无组织树
- ❌ 无成员认证
- ❌ 无审批流程
- ✅ 自动拥有所有权限（起草、协商、签署）

**流程**：个人注册 → 直接起草合同 → 签署 → 完成

#### 2.7.6 多身份管理

**场景**：一个自然人可能既是公司员工，又是个人业主

**实现**：
- 用户可关联多个组织身份
- 登录后切换身份
- 不同身份的合同分开管理

**示例**：
- 张三的身份1：中国移动项目经理（需审批）
- 张三的身份2：个人业主（无需审批）

---

## 3. 功能需求

### 3.1 核心用例列表

| 用例ID | 用例名称 | 主要参与者 | 优先级 |
|-------|---------|-----------|-------|
| UC-01 | 构建组织树 ⭐ | 组织管理员 | P0 |
| UC-02 | 成员导入与认证 ⭐ | 组织管理员、员工 | P0 |
| UC-03 | 创建电信合同 | 公司员工/个人 | P0 |
| UC-04 | RAG增强的AI合同生成 | 公司员工/个人 | P0 |
| UC-05 | 提交树状审批 ⭐ | 公司员工 | P0 |
| UC-06 | 合同协商（双方） | 双方员工 | P0 |
| UC-07 | 双方签署合同 | 双方员工 | P0 |
| UC-08 | AI合规审查 | 系统自动/法务 | P1 |
| UC-09 | 合同变更管理 | 双方员工 | P1 |
| UC-10 | 付款计划管理（简化） | 财务 | P1 |
| UC-11 | 管理电信知识库 | 系统管理员 | P1 |

---

### 3.2 UC-01: 构建组织树 ⭐

**参与者**：组织管理员

**前置条件**：组织已注册，用户是组织管理员

**基本流程**：
1. 管理员进入"组织架构管理"
2. 创建根节点（如"总经理"），设置审批权重（如"无限制"）
3. 添加子节点（如"副总"），设置：
   - 职位名称："副总经理A"
   - 审批权重：200万元
   - 父节点：总经理
4. 继续添加下级节点（处长、科长、员工等）
5. 系统自动计算树路径和层级
6. 保存组织树

**可视化编辑**：
- 拖拽调整节点位置
- 批量设置同级节点权重
- 复制已有分支结构

**后置条件**：组织树已创建，可以开始导入成员

---

### 3.3 UC-02: 成员导入与认证 ⭐

**参与者**：组织管理员、员工

**基本流程**：

**【管理员导入成员】**
1. 管理员选择导入方式：
   - 上传Excel文件（批量）
   - 手动逐个添加
2. 填写成员信息：姓名、手机号、工号、职位名称
3. 系统匹配职位名称到组织树节点
4. 系统为每个成员生成6位认证码
5. 系统发送短信通知成员
6. 成员记录状态="待认证"

**【员工认证身份】**
7. 员工登录系统，进入"添加企业身份"
8. 输入姓名、手机号、认证码
9. 系统验证：
   - 认证码有效性
   - 手机号匹配
10. 认证成功，员工获得该职位身份
11. 成员记录状态="已认证"

**扩展流程**：
- 如认证码过期，管理员可重新生成
- 如手机号变更，管理员可更新后重新发送

**后置条件**：
- 员工已关联到组织和职位节点
- 员工可使用该身份起草/审批合同

---

### 3.4 UC-03: 创建电信合同

**前置条件**：
- 公司员工：已认证企业身份（自动拥有起草权限）
- 个人业主：已注册（自动拥有起草权限）

**基本流程**：
1. 用户选择身份（如有多个）
2. 选择合同类型（基站租赁/网络建设/设备采购/运维服务）
3. 选择创建方式：
   - **AI对话生成**（推荐，跳转UC-04）
   - 使用标准模板
   - 上传已有合同
4. 填写合同要素（金额、工期、付款方式等）
5. **指定对方对接人** ⭐：
   - 输入对方对接人（如李四）的手机号或系统账号
   - 只有该指定的对接人有权限在对方组织内接收合同并**发起对方的内部审批**
   - 系统查找对方用户（如存在）或生成邀请链接
6. 系统自动校验必填项
7. 保存合同，状态为"草稿"

**关键变化**：
- ❌ 不需要授权"起草人"角色，所有员工/个人都可起草
- ✅ 必须指定对方对接人，明确责任链条

**后置条件**：合同已创建，状态="草稿"，已锁定对方对接人

---

### 3.5 UC-04: RAG增强的AI合同生成 ⭐⭐⭐

**核心技术亮点**

**前置条件**：用户已选择合同类型

**基本流程**：

1. **用户输入需求**（自然语言）：
   ```
   "生成一份基站租赁合同，站址在XX市XX路XX号楼顶，
    年租金5万元，租期10年，本方是XX通信公司（甲方）"
   ```

2. **RAG检索知识库**：
   ```python
   # 伪代码
   query_embedding = embedding_model.encode(user_input)
   results = chroma.query(
       query_embedding,
       n_results=5,
       where={"type": "基站租赁合同"}
   )
   # 返回5份最相似的合同模板/条款
   ```

3. **构建增强提示词**：
   ```
   [系统提示]
   你是电信行业合同专家。以下是电信领域知识：
   
   [检索到的合同模板]
   基站租赁合同标准模板...
   
   [检索到的典型条款]
   - 网络覆盖承诺条款
   - 电磁辐射符合标准条款
   - 应急通信保障条款
   
   [用户需求]
   生成基站租赁合同，站址XX，租金5万/年，租期10年...
   
   请生成完整合同。
   ```

4. **LLM生成合同**：
   ```
   调用文心一言/通义千问API，生成合同内容
   ```

5. **AI追问补充信息**（智能对话）：
   ```
   AI："请问站址面积多少平方米？"
   用户："50平米"
   AI："需要约定网络覆盖指标吗？"
   用户："需要，覆盖本栋楼95%以上"
   ```

6. **生成完整合同**，包含电信专业条款：
   - ✅ 站址信息（位置、面积、类型）
   - ✅ 租金条款（金额、支付方式、时间）
   - ✅ 网络覆盖承诺条款
   - ✅ 电磁辐射符合国标条款
   - ✅ 应急通信保障条款
   - ✅ 设备维护责任划分

7. 用户审阅、微调后保存

**核心优势**：
- 🎯 **专业性**：基于电信知识库，生成的合同符合行业规范
- 🎯 **效率**：5分钟 vs 人工2小时
- 🎯 **智能对话**：AI主动追问，补充必要信息

**技术架构**：
```
用户输入 → Embedding向量化 → Chroma检索 
→ 构建提示词 → LLM生成 → 返回合同
```

**后置条件**：AI生成的合同已填充到表单

---

### 3.6 UC-05: 提交树状审批 ⭐⭐⭐

**核心创新点**

**前置条件**：
- 公司员工：合同已创建，状态="草稿"
- 个人业主：**无需审批，直接跳过此流程** ⭐

**基本流程（树状审批）**：

**【计算审批路径】**
1. 用户点击"提交审批"
2. 系统获取起草人的职位节点（如"项目经理"）
3. 系统获取合同金额（如50万元）
4. **沿组织树向上查找审批路径**：
   ```
   起草人：项目经理（权重5万）
   ↓ 检查上级
   科长（权重20万）< 50万 → 需要继续向上 ✓
   ↓ 检查上级
   处长（权重50万）≥ 50万 → 终审人 ⭐
   
   审批路径：[科长, 处长]
   ```
5. 系统创建审批流程实例
6. **异步触发AI合规审查**（UC-08）
7. 通知第一级审批人（科长）
8. 合同状态="审批中"

**【审批人操作】**
9. 审批人查看：
   - 合同详情
   - AI审查报告（如已完成）
   - 起草人信息
   - 自己在审批路径中的位置
10. 审批人操作：
    - **通过**：流转到下一级（或终审完成）
    - **驳回**：退回起草人修改（需说明理由）

**【终审判断】**
11. 如当前审批人的权重 ≥ 合同金额：
    - 这是**终审人**
    - 通过后，合同进入协商阶段（UC-06）
12. 如当前审批人的权重 < 合同金额：
    - 通过后，流转到上级节点
    - 继续审批

**扩展流程**：
- **个人业主**：系统检测到是个人身份，直接跳过审批，状态="待协商"
- **小公司（只有一级审批）**：老板审批后直接完成
- **审批超时**：72小时未审批，自动提醒（可配置）

**优势对比**：

| 传统固定分级 | 本方案（树状+权重）⭐ |
|-------------|---------------------|
| 按金额固定4级路径 | 根据职位权重动态确定 |
| 可能跨部门审批 | 沿本部门树向上 |
| 小额合同也走全流程 | 权重足够即终审 |
| 不适应组织变化 | 调整树即可 |

**后置条件**：
- 审批通过 → 进入协商阶段（UC-06）
- 审批驳回 → 退回修改

---

### 3.7 UC-06: 对方审批与协商（双向审批）⭐⭐⭐

**前置条件**：合同已通过本方内部审批（状态="待对方审批"）

**基本流程**：

**【对方接收与审批发起】**
1. 系统通知对方对接人（如李四）
2. 李四登录查看合同详情和本方审批记录
3. 李四确认无误后，**发起对方内部审批流程** ⭐
   - 系统获取李四的职位节点
   - 沿对方组织树向上查找审批路径（李四→经理→总监...）
   - 直到找到**权重足够**处理该金额合同的领导为止（同本方逻辑）

**【对方审批/驳回】**
4. 对方审批人依次审批
5. **驳回处理**：
   - 对方审批链条中**任一级**驳回，必须填写驳回意见
   - 合同状态变为"协商中"
   - 系统直接将意见反馈给**本方起草人**（如张三）
   - **流程阻断**，必须由张三处理后重新发起

**【协商循环】**
6. 本方起草人（张三）收到对方驳回意见
7. 张三与李四沟通或直接修改合同内容
8. 张三**重新提交本方审批** ⭐
   - 修改后的合同版本必须再次经过本方内部审批（确保修改合规）
   - 本方终审通过后，再次发送给对方对接人（李四）
9. 李四收到新版本，**再次提交对方审批**
   - 对方领导再次审核修改后的内容

**【达成一致】**
10. 当**本方审批通过** AND **对方审批通过**时：
    - 双方所有层级领导均认可当前版本
    - 合同状态="待签署"

**核心逻辑**：
- **双向对等**：双方都要走完自己的树状审批，直到有权人批准
- **指定对接**：李四作为对方唯一入口，负责推动对方内部流程
- **闭环控制**：任何修改都需经过本方再次确认

**后置条件**：
- 双方都审批通过 → 进入签署（UC-07）
- 协商历史完整记录（含双方内部审批记录）

---

### 3.8 UC-07: 双方签署合同 ⭐

**前置条件**：协商完成，合同状态="待签署"

**基本流程**：

**【本方签署】**
1. 本方授权人员（通常为法定代表人或授权代理人）登录
2. 系统显示合同最终版本（含协商修改）
3. 确认签署（电子签章）
4. 系统记录：签署人、时间、IP、设备
5. 合同状态="待对方签署"

**【对方签署】**
6. 系统通知对方签署人
7. 对方授权人员登录签署
8. 系统记录签署信息

**【合同生效】**
9. 双方签署完成
10. 系统自动执行：
    - 生成正式合同编号
    - 生成付款计划（见UC-10）
    - 提醒履约保证金缴纳
    - 生成双方签章的PDF
11. 合同状态="执行中"

**后置条件**：
- 合同正式生效
- 签署记录不可篡改（审计追溯）

---

### 3.9 UC-08: AI合规审查 ⭐

**技术亮点**

**触发时机**：合同提交审批时（异步执行）

**审查内容**（电信行业特有）：

1. **SLA指标检查**（运维服务合同）
   ```
   ❌ 缺失SLA指标
   建议：补充"服务可用性≥99.5%，故障响应≤2小时"
   ```

2. **网络覆盖率检查**（网络建设合同）
   ```
   ⚠️ 覆盖率过低
   约定：城区覆盖率80%
   标准：行业标准≥95%
   建议：调整为≥95%
   ```

3. **应急通信条款检查**
   ```
   ✅ 已包含应急通信保障条款
   ```

4. **数据安全条款检查**
   ```
   ❌ 缺失数据安全承诺
   建议：补充"符合《通信网络安全防护管理办法》"
   ```

**审查结果**：
- **低风险** → 标记✅，继续审批
- **中风险** → 标记⚠️，提示审批人注意
- **高风险** → 标记❌，强制法务审查

**技术实现**：
```
合同文本 → LLM API分析 → 返回风险点列表
提示词：基于《电信条例》等法规，审查合同...
```

**后置条件**：AI审查报告已生成，供审批人参考

---

### 3.10 UC-09: 合同变更管理 ⭐⭐⭐

**前置条件**：合同状态="执行中"

**核心原则**：变更流程完全遵循UC-06的双向审批逻辑

**基本流程**：

**【发起变更】**
1. **发起人**：原合同起草人（如张三）⭐
   - 系统自动识别原起草人
   - 也可由同组织其他人员发起，但需指定原起草人为负责人
2. **接收人**：原合同的对方对接人（如李四）⭐
   - 系统自动锁定，无需重新指定
3. 填写变更内容：
   - 变更类型（金额/工期/技术指标/其他）
   - 变更理由和依据
   - 变更金额（用于计算审批路径）

**【本方内部审批】**
4. 变更申请提交后，**必须先走本方内部树状审批** ⭐
   - 根据变更金额计算审批路径（同UC-05）
   - 必须获得本方有权领导批准
   - 如本方任一级驳回，退回发起人修改

**【对方审批与协商】**
5. 本方审批通过后，系统通知对方对接人（李四）
6. 李四收到变更请求，发起**对方内部树状审批** ⭐
   - 对方审批路径根据变更金额重新计算
   - 层层上报至对方有权领导
7. **协商循环**（同UC-06）：
   - 若对方任一级驳回（提出修改意见）
   - 流程退回本方发起人（张三）
   - 张三修改后重新提交本方审批
   - 本方通过后再次发送给对方
   - 循环直至双方达成一致

**【双方签署变更协议】**
8. 双方内部均审批通过后：
   - 生成《合同变更协议》
   - 双方授权人进行电子签署（同UC-07）

**【变更生效】**
9. 变更协议签署完成后：
   - 更新原合同内容（版本号递增：v1.0 → v2.0）
   - 如金额变更，自动更新付款计划
   - 记录变更历史（可追溯）

**关键设计**：
- ✅ **发起人固定**：原起草人负责变更全流程
- ✅ **接收人固定**：对方对接人负责对方内部推动
- ✅ **双向审批**：双方都要走完自己的树状审批
- ✅ **协商闭环**：任何修改都需双方重新确认

**后置条件**：
- 合同已更新（版本号递增）
- 变更历史完整记录（含双方审批记录）

5. **变更生效**
   - 更新原合同关键信息
   - 记录变更版本历史（v1.0 → v2.0）
   - 自动更新关联的付款计划（如涉及金额变更）

**后置条件**：
- 合同已更新
- 变更过程全链路可追溯（含双方内部审批记录）

---

### 3.11 UC-10: 付款计划管理（简化）

**设计说明**：去掉复杂的工程进度款联动，保留基本付款提醒

**基本流程**：

1. **合同生效时自动生成付款计划**
   - 根据合同约定生成付款时间点
   - 例如：签订后7天付30%，到货后付40%，验收后付30%

2. **到期提醒**
   - 提前15天提醒财务：XX合同第X次付款将于X月X日到期
   - 邮件+站内消息

3. **记录付款执行**
   - 财务手动标记"已支付"
   - 记录实际支付日期和金额

4. **逾期标记**
   - 超过计划日期未支付，自动标记"逾期"

**关键简化**：
- ❌ 不做工程进度与付款联动
- ❌ 不做复杂的超额检查算法
- ❌ 不要求双方确认工程进度
- ✅ 只做基本的计划提醒和记录

**适用场景**：
- ✅ 基站租赁合同：按年付款提醒
- ✅ 设备采购合同：按批次付款提醒
- ✅ 运维服务合同：按月付款提醒
- ⚠️ 网络建设合同：需线下跟进工程进度

---

### 3.12 UC-11: 管理电信知识库

**参与者**：系统管理员、法务人员

**基本功能**：

1. **术语管理**
   - 添加/编辑电信术语（如"基站""SLA"）
   - 关联合同类型

2. **模板管理**
   - 上传历史优秀合同作为模板
   - 系统自动向量化存入Chroma

3. **法规管理**
   - 上传《电信条例》等法规文档
   - 用于AI合规审查

4. **典型条款库**
   - 维护100+标准条款
   - 如"网络覆盖承诺条款""应急通信条款"

**后置条件**：知识库已更新，AI生成质量提升

---

## 4. 非功能需求

### 4.1 性能需求

| 指标 | 要求 |
|-----|------|
| **AI合同生成响应时间** | ≤30秒（含RAG检索+LLM生成） |
| **RAG检索响应时间** | ≤3秒 |
| **审批流程响应** | ≤2秒 |
| **并发用户数** | ≥50 |

### 4.2 安全需求

- **数据传输**：HTTPS加密
- **数据存储**：合同文件加密存储
- **权限控制**：RBAC，多租户（组织）数据严格隔离
- **审计日志**：所有操作可追溯

### 4.3 可用性需求

- **系统可用性**：≥99%
- **AI降级机制**：LLM API失败时，降级为模板填写
- **数据备份**：每日自动备份

---

## 5. 数据需求

### 5.1 核心实体

```
组织 (Organization) ⭐
├─ 组织类型（电信运营商/普通公司/个人业主）
├─ 公司名称 / 个人姓名
└─ 统一社会信用代码 / 身份证

组织树节点 (OrganizationTreeNode) ⭐ 新增
├─ 职位名称（如"总经理"、"科长"）
├─ 审批权重（可终审的最大金额）
├─ 父节点ID（树结构）
└─ 树路径（便于查询）

组织成员 (OrganizationMember) ⭐ 新增
├─ 姓名、手机号、工号
├─ 关联职位节点
├─ 认证状态（待认证/已认证）
├─ 认证码
└─ 关联用户ID（认证后绑定）

用户 (User)
├─ 基本信息（姓名、手机号）
├─ 可关联多个组织成员（多身份）⭐
└─ 主要身份标识

合同 (Contract)
├─ 合同类型
├─ 双方组织ID（动态角色：本方/对方）⭐
├─ 本方法律角色（甲方/乙方，用于合同展示）
├─ 合同状态（草稿/审批中/待协商/待签署/执行中/已完成）
├─ 创建人及所属组织
└─ 版本号（变更后递增）

审批流程 (ApprovalFlow)
├─ 合同ID
├─ 审批路径（职位节点列表）⭐
├─ 当前审批节点
└─ 审批状态

审批节点 (ApprovalNode) ⭐ 新增
├─ 关联职位节点ID
├─ 审批顺序
├─ 审批人ID
├─ 审批结果
└─ 审批时间

协商记录 (Negotiation)
├─ 轮次
├─ 提议方组织
├─ 修改内容
└─ 结果

签署记录 (Signature)
├─ 签署组织
├─ 签署人/时间/IP
└─ 签署哈希

合同变更 (ContractChange)
├─ 变更类型
├─ 变更金额
├─ 协商+审批+签署状态
└─ 生效时间

付款计划 (PaymentPlan)（简化）
├─ 付款批次
├─ 计划金额
├─ 计划日期
└─ 执行状态
```

### 5.2 数据库设计（简要）

**核心表**：

**组织管理**：⭐ 新增
- `organizations`：组织表（公司/个人）
- `organization_tree_nodes`：组织树节点表（职位+权重）
- `organization_members`：成员表（待认证+已认证）
- `users`：用户表
- `user_organizations`：用户-组织关联表（多身份）

**合同管理**：
- `contracts`：合同表
- `negotiations`：协商记录表
- `signatures`：签署记录表
- `contract_changes`：变更记录表
- `payment_plans`：付款计划表（简化）

**审批管理**：⭐ 重新设计
- `approval_flows`：审批流程表
- `approval_nodes`：审批节点表（关联职位节点）

**知识库**：
- `telecom_knowledge`：电信知识库（向量存储在Chroma）

**关键设计变化**：
- ✅ 新增：组织树相关4张表
- ✅ 重构：审批流程表（关联职位节点）
- ✅ 优化：用户可关联多个组织
- ❌ 删除：固定角色授权表
- ❌ 删除：工程进度相关表

---

## 6. 附录

### 6.1 系统实施路线图

**总计：13周（3.25个月）**

| 阶段 | 周数 | 内容 | 优先级 |
|-----|-----|------|-------|
| **阶段1** | 1-2周 | **组织树管理+成员认证** ⭐ | P0 |
| **阶段2** | 3周 | **多身份管理+身份切换** | P0 |
| **阶段3** | 4-5周 | 合同CRUD、表单创建、文件上传 | P0 |
| **阶段4** | 6周 | **树状审批工作流+权重控制** ⭐ | P0 |
| **阶段5** | 7周 | **合同协商+签署**（双方协同） | P0 |
| **阶段6** | 8-9周 | **RAG知识库+AI生成** | P1 |
| **阶段7** | 10-11周 | **AI合规审查+知识库管理** | P1 |
| **阶段8** | 12周 | **合同变更管理** | P1 |
| **阶段9** | 13周 | 付款计划提醒、测试优化 | P2 |

**关键里程碑**：
- Week 3：完成组织管理核心（树+认证+多身份）⭐
- Week 6：完成树状审批（核心创新点）⭐
- Week 7：完成双方协同基础功能（协商+签署）
- Week 11：完成AI核心功能（RAG+生成+审查）
- Week 13：系统整体验收

**新增时间说明**：
- 组织树管理较平面角色复杂，增加1周开发时间
- 总周期：12周 → 13周（增加8%，但价值提升显著）

### 6.2 技术栈

| 层次 | 技术选型 |
|-----|---------|
| **前端** | Vue 3 + TypeScript + Element Plus |
| **后端** | Spring Boot 3 + MyBatis Plus |
| **AI服务** | Python FastAPI + LangChain |
| **向量数据库** | Chroma（本地部署） |
| **LLM API** | 文心一言/通义千问/ChatGPT |
| **Embedding** | text2vec-base-chinese |
| **数据库** | MySQL 8.0 |
| **对象存储** | MinIO / 阿里云OSS |
| **缓存** | Redis 7.0 |

### 6.3 开发可行性评估

| 功能模块 | 难度 | 开发时间 | 风险 |
|---------|-----|---------|------|
| 组织树管理 ⭐ | ⭐⭐ 中 | 1周 | 低 |
| 成员认证 ⭐ | ⭐⭐ 中 | 1周 | 低 |
| 多身份管理 | ⭐⭐ 中 | 1周 | 低 |
| 合同CRUD | ⭐ 低 | 2周 | 低 |
| 树状审批 ⭐ | ⭐⭐⭐ 中高 | 1周 | 中 |
| 双方协商 | ⭐⭐ 中 | 1周 | 低 |
| 双方签署 | ⭐⭐ 中 | 1周 | 低 |
| RAG知识库 | ⭐⭐⭐ 中高 | 2周 | 中 |
| AI合同生成 | ⭐⭐⭐ 中高 | 2周 | 中 |
| AI合规审查 | ⭐⭐⭐ 中高 | 2周 | 中 |
| 合同变更 | ⭐⭐ 中 | 1周 | 低 |
| 付款提醒 | ⭐ 低 | 1周 | 低 |

**核心难点分析**：
1. **组织树可视化**：前端树形组件（Element Plus Tree现成）⭐
2. **树状审批路径计算**：递归查找父节点+权重判断⭐
3. **多身份切换**：前端状态管理（Pinia）

**总体评估**：
- ✅ **技术可行**：无超出课程范围的技术
- ✅ **时间充足**：13周合理可控（仅比平面角色多1周）
- ✅ **风险可控**：AI失败有降级机制
- ✅ **创新价值高**：组织树+权重控制是核心亮点 ⭐

### 6.4 版本演进对比

| 对比项 | v3.0完整版 | v3.0-Lite | v4.0-Lite（本版本）⭐ |
|-------|-----------|----------|---------------------|
| **核心聚焦** | 合同+工程进度款 | 合同生命周期 | **组织树+树状审批** ⭐ |
| **组织管理** | 平面角色授权 | 平面角色授权 | **组织树+成员认证** ⭐ |
| **审批机制** | 金额固定分级 | 金额固定分级 | **树状审批+权重控制** ⭐ |
| **通用性** | 适配不同规模需手动 | 适配不同规模需手动 | **自配置树，自动适配** ⭐ |
| **用例数量** | 13个 | 9个 | **11个** |
| **核心实体** | 7个 | 5个 | **9个**（+组织树相关） |
| **开发周期** | 16周 | 12周 | **13周** |
| **技术复杂度** | 高 | 中等 | **中高**（树算法+） |
| **RAG+AI** | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| **双方协同** | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| **创新价值** | AI+工程进度 | AI专注合同 | **组织树+权重** ⭐⭐⭐ |

**v4.0-Lite 核心优势**：
- ✅ **符合实际企业管理**：组织树反映真实层级关系
- ✅ **审批路径清晰**：沿部门树向上，不跨部门
- ✅ **权重控制高效**：小额合同快速终审
- ✅ **通用性强**：大中小公司、个人都适用
- ✅ **安全可控**：成员认证机制，防止随意授权
- ✅ **多身份支持**：一个用户多个组织身份

**v4.0-Lite 创新点**：
1. **组织树结构**：可视化企业层级，符合管理直觉 ⭐⭐⭐
2. **树状审批**：沿组织树向上审批，路径清晰 ⭐⭐⭐
3. **权重控制**：职位权重≥金额时自动终审 ⭐⭐⭐
4. **成员认证**：认证码激活身份，安全可控 ⭐⭐
5. **多身份管理**：支持个人+多公司身份 ⭐⭐

**成本分析**：
- 开发时间：仅比v3.0-Lite多1周（8%增长）
- 价值提升：管理逻辑更符合实际，通用性显著提升
- **性价比**：极高 ⭐⭐⭐⭐⭐

**建议选择**：
- 如需简单快速 → v3.0-Lite（12周，平面角色）
- 如追求高质量+实际管理逻辑 → **v4.0-Lite（本版本）** ⭐⭐⭐
- 如需工程进度款深度监控 → v3.0完整版（16周）

---

## 文档总结

### ✅ 本版本核心价值（v4.0-Lite）

1. **组织树管理**：反映真实企业层级，支持可视化配置 ⭐⭐⭐
2. **树状审批机制**：沿组织树审批+权重控制，高效且符合实际 ⭐⭐⭐
3. **成员认证**：认证码激活身份，安全可控
4. **多身份支持**：个人业主+多公司员工身份并存
5. **RAG+AI技术**：电信知识库、智能生成、合规审查
6. **双方协同完整**：协商、签署、变更全流程
7. **电信领域普适性**：通用付款模式、可扩展合同类型

### ✅ 核心创新点

| 创新点 | 价值 | 实现难度 |
|-------|------|---------|
| **组织树结构** ⭐⭐⭐ | 符合企业实际管理逻辑 | 中 |
| **树状审批+权重控制** ⭐⭐⭐ | 审批路径清晰、高效 | 中高 |
| **成员认证机制** ⭐⭐ | 防止随意授权，安全可控 | 中 |
| **多身份管理** ⭐⭐ | 一个用户多组织身份 | 中 |
| **RAG电信知识库** ⭐⭐⭐ | AI生成符合电信规范 | 中高 |
| **双方在线协商** ⭐⭐ | 完整合同生命周期 | 中 |

### ✅ 课程目标达成

- ✅ **深度而非广度**：聚焦电信领域合同管理
- ✅ **技术创新**：组织树+RAG技术双创新点 ⭐⭐⭐
- ✅ **业务完整**：覆盖合同完整生命周期+组织管理
- ✅ **符合实际**：审批机制贴合真实企业管理 ⭐⭐⭐
- ✅ **通用性强**：大中小企业+个人业主都适用 ⭐⭐
- ✅ **可实现性**：13周可完成，技术风险可控
- ✅ **高质量**：专业性强、逻辑清晰、可维护性高

### 📊 关键数据

- **版本号**：v4.0-Lite（组织树+树状审批版）
- **用例数**：11个（比v3.0-Lite增加2个组织管理用例）
- **核心实体**：9个（增加组织树、成员、审批配置等）
- **开发周期**：13周（比v3.0-Lite仅多1周，性价比极高）
- **技术亮点**：组织树+权重审批+RAG+双方协同
- **覆盖场景**：98%电信合同场景（大中小企业+个人）
- **文档规模**：约13,500字（高质量、聚焦、非冗余）

### 🎯 适用场景

**✅ 强烈推荐（本版本）**：
- 追求高质量+实际管理逻辑
- 需要适配不同规模企业
- 重视审批流程清晰性
- 时间充足（13周）

**⚠️ 不推荐场景**：
- 时间极度紧张（<10周）→ 建议v3.0-Lite
- 需要工程进度款深度监控 → 建议v3.0完整版

### 🔑 成功要素

1. **组织树可视化**：使用Element Plus Tree组件
2. **树状审批算法**：递归查找父节点+权重判断
3. **成员认证**：认证码或邀请链接
4. **身份切换**：前端Pinia状态管理
5. **RAG知识库**：Chroma+text2vec-base-chinese
6. **双方协商**：WebSocket实时推送

---

**文档状态**：✅ 正式发布（v4.0-Lite 组织树版）

**核心口号**：  
🎯 **组织树+权重审批，贴合实际的电信合同管理！** ⭐⭐⭐

📅 最后更新：2025年11月24日  
📝 版本：v4.0-Lite（Simplified with Organization Tree）  
👥 目标用户：大中小型电信企业+个人业主


